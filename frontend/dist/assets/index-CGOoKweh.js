import{ad as Wt,ae as e,r as n,af as Ce,ag as Pt,ah as ht,ai as mt,aj as At,ak as Et,al as Bt,am as rt,an as xe,ao as Nt,ap as Lt,aq as yt,ar as Ot,as as bt,at as ot,au as lt,av as vt,aw as Mt,ax as Ft,ay as wt,az as jt,aA as Ut,aB as Vt,aC as Ht,aD as qt,aE as $t,aF as Yt,aG as _t,aH as Gt,aI as He,aJ as qe,aK as dt,aL as Qt,aM as Xe,aN as at,aO as Kt,aP as Jt,aQ as je,aR as Xt,R as Zt,aS as en}from"./vendor-B3lGcCuq.js";import{R as Oe,B as it,C as Qe,X as Ke,Y as Je,T as Me,a as st,P as St,b as Ct,c as kt,L as tn,d as nn}from"./recharts-DOHgEW8A.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const d of a)if(d.type==="childList")for(const C of d.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&o(C)}).observe(document,{childList:!0,subtree:!0});function s(a){const d={};return a.integrity&&(d.integrity=a.integrity),a.referrerPolicy&&(d.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?d.credentials="include":a.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function o(a){if(a.ep)return;a.ep=!0;const d=s(a);fetch(a.href,d)}})();const on="/api",j=Wt.create({baseURL:on,headers:{"Content-Type":"application/json"}});j.interceptors.request.use(t=>{const i=localStorage.getItem("token");return i&&(t.headers.Authorization=`Bearer ${i}`),t});j.interceptors.response.use(t=>t,t=>{var s,o,a;const i=(s=t.response)==null?void 0:s.status;if(i===401||i===403){localStorage.removeItem("token"),localStorage.removeItem("user");const d=window.location.pathname;if(d.startsWith("/admin"))d!=="/admin/login"&&(window.location.href="/admin/login");else if(d.startsWith("/staff")&&d!=="/staff/login"){const h=((a=(o=t.response)==null?void 0:o.data)==null?void 0:a.code)==="STAFF_LOGOUT_6PM"?"?reason=logout_6pm":"";window.location.href="/staff/login"+h}}return Promise.reject(t)});function Ae(){const t=localStorage.getItem("user");if(t==null||t===""||t==="undefined")return null;try{return JSON.parse(t)}catch{return null}}const ct="queueEntry",pt="queueDate",It=t=>{const i=new Date().toISOString().split("T")[0];localStorage.setItem(ct,JSON.stringify(t)),localStorage.setItem(pt,i)},Ze=()=>{const t=localStorage.getItem(ct),i=localStorage.getItem(pt),s=new Date().toISOString().split("T")[0];if(!t||i!==s)return i!==s&&$e(),null;try{return JSON.parse(t)}catch{return $e(),null}},$e=()=>{localStorage.removeItem(ct),localStorage.removeItem(pt)};function re({label:t,error:i,style:s,disabled:o,...a}){const d={width:"100%",padding:"12px",borderRadius:"8px",border:i?"2px solid #ef4444":"2px solid #e2e8f0",fontSize:"16px",transition:"border-color 0.2s",...o&&{background:"#f1f5f9",color:"#64748b",cursor:"not-allowed"},...s};return e.jsxs("div",{style:{marginBottom:"16px"},children:[t&&e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500",color:"#1e293b"},children:t}),e.jsx("input",{style:d,disabled:o,...a}),i&&e.jsx("div",{style:{marginTop:"4px",fontSize:"12px",color:"#ef4444"},children:i})]})}function M({children:t,onClick:i,variant:s="primary",disabled:o=!1,fullWidth:a=!1,icon:d,iconPosition:C="left",type:h,style:p,...g}){const u={padding:"10px 20px",borderRadius:"8px",border:"none",fontSize:"14px",fontWeight:"600",cursor:o?"not-allowed":"pointer",transition:"all 0.2s",opacity:o?.6:1,width:a?"100%":"auto",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",boxShadow:s==="primary"||s==="success"||s==="danger"||s==="gradient"?"0 2px 4px rgba(0,0,0,0.1)":"none",...p},r={primary:{background:o?"#cbd5e1":"#2563eb",color:"white"},gradient:{background:o?"#cbd5e1":"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",boxShadow:o?"none":"0 4px 12px rgba(102, 126, 234, 0.4)"},secondary:{background:o?"#cbd5e1":"#64748b",color:"white"},success:{background:o?"#cbd5e1":"#10b981",color:"white"},danger:{background:o?"#cbd5e1":"#ef4444",color:"white"},outline:{background:"transparent",color:o?"#cbd5e1":"#2563eb",border:`2px solid ${o?"#cbd5e1":"#2563eb"}`}},S=r[s]||r.primary,T=d&&e.jsx(d,{size:18,strokeWidth:2.5}),P=C==="left"?e.jsxs(e.Fragment,{children:[" ",T," ",t," "]}):e.jsxs(e.Fragment,{children:[" ",t," ",T," "]});return e.jsx("button",{type:h||"button",style:{...u,...S},onClick:o?void 0:i,disabled:o,onMouseOver:f=>{o||(s==="primary"?(f.target.style.background="#1e40af",f.target.style.boxShadow="0 4px 8px rgba(37, 99, 235, 0.3)"):s==="outline"?f.target.style.background="#eff6ff":s==="danger"?(f.target.style.background="#dc2626",f.target.style.boxShadow="0 4px 8px rgba(239, 68, 68, 0.3)"):s==="success"?(f.target.style.background="#059669",f.target.style.boxShadow="0 4px 8px rgba(16, 185, 129, 0.3)"):s==="gradient"&&(f.target.style.background="linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%)",f.target.style.boxShadow="0 6px 16px rgba(102, 126, 234, 0.5)"))},onMouseOut:f=>{o||(f.target.style.background=S.background,f.target.style.boxShadow=s==="gradient"?"0 4px 12px rgba(102, 126, 234, 0.4)":s==="primary"||s==="success"||s==="danger"?"0 2px 4px rgba(0,0,0,0.1)":"none")},...g,children:P})}function ke(){return e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",border:"4px solid #e2e8f0",borderTop:"4px solid #2563eb",borderRadius:"50%",animation:"spin 1s linear infinite"}}),e.jsx("style",{children:`
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
      `})]})}const an="Queuing System";function Ie({size:t="medium",showText:i=!0,showTitle:s=!0,titlePosition:o="next",align:a="left",gap:d="12px",variant:C="default"}){const[h,p]=n.useState(null),[g,u]=n.useState(null),[r,S]=n.useState(!0),[T,P]=n.useState(!1);n.useEffect(()=>{f();const q=setInterval(f,3e4);return()=>clearInterval(q)},[]),n.useEffect(()=>{if(!s)return;N();const q=setInterval(N,3e4);return()=>clearInterval(q)},[s]);const f=async()=>{try{const q=await j.get("/admin/settings/logo");if(q.data.logoUrl){let ne=q.data.logoUrl;ne&&!ne.startsWith("http")&&!ne.startsWith("/")&&(ne="/"+ne);const m=ne.includes("?")?"&":"?";ne=ne+m+"_t="+Date.now(),p(ne),P(!1)}else p(null),P(!1)}catch(q){console.error("Failed to load logo:",q),P(!0)}finally{S(!1)}},N=async()=>{try{const q=await j.get("/admin/settings/site-title");u(q.data.siteTitle||null)}catch(q){console.error("Failed to load site title:",q),u(null)}},y={small:{width:"80px",height:"40px"},medium:{width:"120px",height:"60px"},large:{width:"180px",height:"90px"},monitor:{width:"88px",height:"80px"}},l=y[t]||y.medium,D=t==="small"?"18px":t==="large"?"28px":t==="monitor"?"18px":"24px",A=t==="small"?"14px":t==="large"?"20px":t==="monitor"?"14px":"16px",R=C==="monitor",E={fontSize:D,fontWeight:"700",color:R?"#e5e7eb":"#1e293b",...R&&{textShadow:"0 2px 4px rgba(0,0,0,0.6)"}},H={fontSize:A,fontWeight:"600",color:R?"#e5e7eb":"#64748b",textTransform:"uppercase",...R&&{textShadow:"0 2px 4px rgba(0,0,0,0.6)"}},$=a==="center";if(r)return null;const oe=e.jsx(e.Fragment,{children:h&&!T?e.jsx("img",{src:h,alt:"Logo",style:{...l,objectFit:"contain",maxWidth:"100%"},onError:()=>{P(!0),p(null)}}):e.jsx("div",{style:{...l,display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:"8px",color:"white",fontWeight:"700",fontSize:t==="small"?"14px":t==="large"?"24px":"18px"},children:"Q"})}),ee=s?e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:0,alignItems:$?"center":"flex-start",textAlign:$?"center":"left"},children:[g&&e.jsx("span",{style:E,children:g}),e.jsx("span",{style:H,children:an})]}):null;return o==="below"&&(oe||ee)?e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:$?"center":"flex-start",gap:"8px"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:$?"center":void 0,gap:d},children:oe}),ee]}):e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:d,flexDirection:"row"},children:[oe,ee]})}const sn=[{value:"REGULAR",label:"Regular"},{value:"SENIOR_CITIZEN",label:"Senior Citizen"},{value:"PWD",label:"PWD"},{value:"PREGNANT",label:"Pregnant"}];function rn(){var N;const t=Ce(),[i,s]=n.useState(!0),[o,a]=n.useState(!1),[d,C]=n.useState([]),[h,p]=n.useState({clientName:"",clientType:"REGULAR",categoryIds:[],subCategoryIds:[]}),[g,u]=n.useState({});n.useEffect(()=>{r()},[]);const r=async()=>{var y;try{const l=await j.get("/categories");C(Array.isArray((y=l.data)==null?void 0:y.categories)?l.data.categories:[])}catch(l){console.error("Failed to load categories:",l)}finally{s(!1)}},S=n.useMemo(()=>{var D;if(!((D=h.categoryIds)!=null&&D.length))return[];const y=(d||[]).filter(A=>h.categoryIds.includes(A.id)),l=new Map;return y.forEach(A=>{(A.subCategories||[]).forEach(R=>{l.has(R.id)||l.set(R.id,{...R,categoryName:A.name})})}),Array.from(l.values())},[h.categoryIds,d]),T=y=>{const l=h.categoryIds||[],D=l.includes(y)?l.filter(E=>E!==y):[...l,y],A=(d||[]).filter(E=>D.includes(E.id)),R=new Set;A.forEach(E=>{(E.subCategories||[]).forEach(H=>R.add(H.id))}),p({...h,categoryIds:D,subCategoryIds:(h.subCategoryIds||[]).filter(E=>R.has(E))})},P=y=>{const l=h.subCategoryIds||[],D=l.includes(y)?l.filter(A=>A!==y):[...l,y];p({...h,subCategoryIds:D})},f=async y=>{var D,A,R,E;y.preventDefault(),u({});const l={};if(h.clientName.trim()||(l.clientName="Name is required"),(D=h.categoryIds)!=null&&D.length||(l.categoryId="Select at least one category"),Object.keys(l).length>0){u(l);return}a(!0);try{const $=(await j.post("/queue/join",{clientName:h.clientName.trim(),clientType:h.clientType,categoryIds:h.categoryIds,subCategoryIds:(A=h.subCategoryIds)!=null&&A.length?h.subCategoryIds:void 0})).data.queueEntry,oe=($.concernCategories||[$.category]).map(q=>q.name).join(", "),ee=($.concernSubCategories||[]).map(q=>q.name).join(", ")||null;It({queueNumber:$.queueNumber,clientName:$.clientName,date:$.date,category:oe,subCategory:ee,clientType:$.clientType,status:$.status}),t("/success")}catch(H){console.error("Failed to join queue:",H),u({submit:((E=(R=H.response)==null?void 0:R.data)==null?void 0:E.error)||"Failed to join queue"})}finally{a(!1)}};return i?e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ke,{})}):e.jsx("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:"20px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{background:"white",borderRadius:"16px",padding:"32px",maxWidth:"500px",width:"100%",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[e.jsx("div",{style:{marginBottom:"24px",display:"flex",justifyContent:"center"},children:e.jsx(Ie,{size:"medium",titlePosition:"below",align:"center"})}),e.jsx("h1",{style:{fontSize:"28px",fontWeight:"700",marginBottom:"8px",color:"#1e293b",textAlign:"center"},children:"Join Queue"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",textAlign:"center",marginBottom:"32px"},children:"Fill in your details to get a queue number"}),e.jsxs("form",{onSubmit:f,children:[e.jsx(re,{label:"Your Name",value:h.clientName,onChange:y=>p({...h,clientName:y.target.value}),error:g.clientName,placeholder:"Enter your full name",required:!0}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",marginBottom:"10px",color:"#1e293b"},children:"Client Type"}),e.jsx("div",{className:"client-type-pills",children:sn.map(({value:y,label:l})=>e.jsxs("label",{className:`pill-radio ${h.clientType===y?"selected":""}`,children:[e.jsx("input",{type:"radio",name:"clientType",value:y,checked:h.clientType===y,onChange:()=>p({...h,clientType:y})}),e.jsx("span",{children:l})]},y))})]}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsxs("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",marginBottom:"10px",color:"#1e293b"},children:["Concern Category ",e.jsx("span",{style:{color:"#ef4444"},children:"*"})]}),g.categoryId&&e.jsx("div",{style:{fontSize:"12px",color:"#ef4444",marginBottom:"8px"},children:g.categoryId}),e.jsx("div",{className:"checkbox-group",children:(d||[]).map(y=>e.jsxs("label",{className:`checkbox-row ${(h.categoryIds||[]).includes(y.id)?"selected":""}`,children:[e.jsx("input",{type:"checkbox",checked:(h.categoryIds||[]).includes(y.id),onChange:()=>T(y.id)}),e.jsx("span",{className:"checkmark"}),e.jsx("span",{children:y.name})]},y.id))})]}),S.length>0&&e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",marginBottom:"10px",color:"#1e293b"},children:"Sub-Concern (Optional)"}),e.jsx("div",{className:"checkbox-group",children:S.map(y=>e.jsxs("label",{className:`checkbox-row ${(h.subCategoryIds||[]).includes(y.id)?"selected":""}`,children:[e.jsx("input",{type:"checkbox",checked:(h.subCategoryIds||[]).includes(y.id),onChange:()=>P(y.id)}),e.jsx("span",{className:"checkmark"}),e.jsx("span",{children:y.name})]},y.id))})]}),g.submit&&e.jsx("div",{style:{padding:"12px",background:"#fee2e2",color:"#991b1b",borderRadius:"8px",marginBottom:"16px",fontSize:"14px"},children:g.submit}),e.jsx(M,{type:"submit",variant:"gradient",fullWidth:!0,disabled:o||!h.clientType||!((N=h.categoryIds)!=null&&N.length),style:{marginTop:"8px",padding:"14px 24px",fontSize:"16px"},children:o?"Joining...":"Join Queue"})]}),e.jsx("div",{style:{marginTop:"24px",textAlign:"center"},children:e.jsx("a",{href:"/monitor",style:{color:"#2563eb",textDecoration:"none",fontSize:"14px"},children:"View Queue Status â†’"})})]})})}function et(t){if(!t)return"";const i=t.split("-");return i.length>1?i[1]:t}function ln(t){return t?t.split("_").map(i=>i.charAt(0).toUpperCase()+i.slice(1).toLowerCase()).join(" "):""}function Tt({window:t,compact:i=!1}){const{label:s,staff:o,currentServing:a}=t,d=g=>{const u=g.trim().split(" ");return u.length>=2?(u[0][0]+u[u.length-1][0]).toUpperCase():g.substring(0,2).toUpperCase()},C=(o==null?void 0:o.name)||"â€”",h=a?et(a.queueNumber):null,p=a&&[a.clientName||"",a.clientType?`(${ln(a.clientType)})`:""].filter(Boolean).join(" ").trim()||null;return e.jsxs("div",{style:{background:"#0b1120",borderRadius:"12px",padding:0,boxShadow:"0 4px 12px rgba(15,23,42,0.6)",border:"1px solid #1e293b",transition:"all 0.2s",display:"flex",alignItems:"stretch",minHeight:i?0:"96px",flex:1,overflow:"hidden"},children:[e.jsxs("div",{style:{flex:i?"0 0 28%":"0 0 34%",maxWidth:i?"70px":"110px",minHeight:0,overflow:"hidden",borderRadius:"12px",background:o!=null&&o.profilePicture?void 0:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[o!=null&&o.profilePicture?e.jsx("img",{src:o.profilePicture,alt:C,style:{width:"100%",height:"100%",objectFit:"cover",display:"block",minHeight:0}}):e.jsx("span",{style:{color:"white",fontWeight:"700",fontSize:i?"18px":"24px"},children:d(C)}),e.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,padding:i?"2px 4px":"4px 6px",background:"rgba(0,0,0,0.65)",color:"#38bdf8",fontSize:i?"12px":"16px",fontWeight:"700",textAlign:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:s})]}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",minWidth:0,padding:i?"4px 6px 4px 6px":"6px 8px 6px 8px"},children:[e.jsx("div",{style:{fontSize:i?"13px":"18px",fontWeight:"700",color:"#e5e7eb",marginBottom:"2px",lineHeight:1.2,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:C}),a?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{fontSize:i?"9px":"11px",fontWeight:"700",color:"#cbd5f5",marginBottom:"2px"},children:"is now serving:"}),e.jsx("div",{style:{fontSize:i?"clamp(18px, 2.8vh, 28px)":"clamp(28px, 3.5vw, 44px)",fontWeight:"700",color:"#fbbf24",lineHeight:1.05,marginBottom:"4px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:h}),p&&e.jsx("div",{style:{marginTop:"auto",paddingTop:"4px",fontSize:i?"10px":"13px",fontWeight:"600",color:"#cbd5f5",lineHeight:1.2,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:p})]}):e.jsx("div",{style:{fontSize:i?"9px":"11px",fontWeight:"600",color:"#64748b",fontStyle:"italic"},children:"No active service"})]})]})}function Dt({clientType:t}){const i={REGULAR:{bg:"#e2e8f0",color:"#475569"},SENIOR_CITIZEN:{bg:"#fee2e2",color:"#991b1b"},PWD:{bg:"#ffedd5",color:"#c2410c"},PREGNANT:{bg:"#fce7f3",color:"#9f1239"}},s={REGULAR:"Regular",SENIOR_CITIZEN:"Senior",PWD:"PWD",PREGNANT:"Pregnant"},o=i[t]||i.REGULAR;return e.jsx("span",{style:{display:"inline-block",padding:"4px 12px",borderRadius:"12px",fontSize:"12px",fontWeight:"600",backgroundColor:o.bg,color:o.color},children:s[t]||"Regular"})}function dn(){const t=Ce(),[i,s]=n.useState(null),[o,a]=n.useState([]),[d,C]=n.useState(!0),[h,p]=n.useState(0);n.useEffect(()=>{const S=Ze();if(!S){t("/");return}s(S),g();const T=setInterval(g,2e3);return()=>clearInterval(T)},[t]),n.useEffect(()=>{(i==null?void 0:i.status)==="SERVED"&&t("/thank-you")},[i==null?void 0:i.status,t]);const g=async()=>{var S;try{const T=Ze()||i;if(T!=null&&T.queueNumber){const N=(await j.get(`/queue/${T.queueNumber}`)).data.queueEntry,y={...T,status:N.status};if(s(y),It(y),N.status==="SERVED"){t("/thank-you");return}if(N.status==="WAITING")try{const l=await j.get(`/queue/${T.queueNumber}/ahead`);p(l.data.peopleAhead||0)}catch{const D=await j.get("/queue/public/stats");p(D.data.waiting||0)}else p(0)}const P=await j.get("/queue/public/windows");a(P.data.windows)}catch(T){console.error("Failed to load data:",T),((S=T.response)==null?void 0:S.status)===404&&($e(),t("/"))}finally{C(!1)}};if(d||!i)return e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ke,{})});const u={WAITING:{bg:"#fef3c7",color:"#92400e",text:"Waiting"},NOW_SERVING:{bg:"#dbeafe",color:"#1e40af",text:"Being served"},SERVED:{bg:"#d1fae5",color:"#065f46",text:"Served"},SKIPPED:{bg:"#fee2e2",color:"#991b1b",text:"Skipped"}},r=u[i.status]||u.WAITING;return e.jsx("div",{style:{minHeight:"100vh",background:"#f8fafc",padding:"20px"},children:e.jsxs("div",{style:{maxWidth:"1200px",margin:"0 auto"},children:[e.jsx("div",{style:{marginBottom:"24px",display:"flex",justifyContent:"center"},children:e.jsx(Ie,{size:"medium",titlePosition:"below",align:"center"})}),e.jsxs("div",{style:{background:"white",borderRadius:"16px",padding:"32px",marginBottom:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px"},children:["Hello, ",i.clientName]}),e.jsx("div",{style:{fontSize:"48px",fontWeight:"700",color:"#2563eb",marginBottom:"16px",letterSpacing:"2px"},children:et(i.queueNumber)}),e.jsx("div",{style:{display:"inline-block",padding:"8px 16px",borderRadius:"20px",backgroundColor:r.bg,color:r.color,fontSize:"14px",fontWeight:"600",marginBottom:"16px"},children:r.text}),e.jsxs("div",{style:{marginTop:"16px",display:"flex",gap:"12px",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx(Dt,{clientType:i.clientType}),e.jsxs("span",{style:{padding:"4px 12px",borderRadius:"12px",fontSize:"12px",fontWeight:"600",backgroundColor:"#e2e8f0",color:"#475569"},children:[i.category,i.subCategory&&` - ${i.subCategory}`]})]}),i.status==="WAITING"&&h>0&&e.jsxs("div",{style:{marginTop:"16px",fontSize:"14px",color:"#64748b"},children:["Approximately ",h," ",h===1?"person":"people"," ahead"]}),e.jsx("div",{style:{marginTop:"24px",padding:"16px",background:"#f1f5f9",borderRadius:"8px",fontSize:"14px",color:"#475569"},children:"ðŸ’¡ You can leave and monitor your queue status from this page. We'll update automatically."})]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("h2",{style:{fontSize:"20px",fontWeight:"600",marginBottom:"16px",color:"#1e293b"},children:"Active Windows"}),e.jsx("div",{className:"grid-responsive",style:{display:"grid",gap:"16px"},children:o.length>0?o.map(S=>e.jsx(Tt,{window:S},S.id)):e.jsx("div",{style:{gridColumn:"1 / -1",textAlign:"center",padding:"40px",background:"white",borderRadius:"12px",color:"#64748b"},children:"No active windows at the moment"})})]})]})})}function cn(){const t=Ce();n.useEffect(()=>{const s=Ze();if(!s||s.status!=="SERVED"){t("/");return}const o=setTimeout(()=>{$e()},5e3);return()=>clearTimeout(o)},[t]);const i=Ze();return e.jsx("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},children:e.jsxs("div",{style:{background:"white",borderRadius:"16px",padding:"48px",maxWidth:"600px",width:"100%",boxShadow:"0 20px 60px rgba(0,0,0,0.3)",textAlign:"center"},children:[e.jsx("div",{style:{marginBottom:"24px",display:"flex",justifyContent:"center"},children:e.jsx(Ie,{size:"medium"})}),e.jsx("div",{style:{fontSize:"64px",marginBottom:"24px"},children:"âœ…"}),e.jsx("h1",{style:{fontSize:"32px",fontWeight:"700",marginBottom:"16px",color:"#1e293b"},children:"Thank You!"}),i&&e.jsxs("p",{style:{fontSize:"18px",color:"#64748b",marginBottom:"24px"},children:["Thank you, ",e.jsx("strong",{children:i.clientName}),", for your visit."]}),e.jsx("p",{style:{fontSize:"16px",color:"#475569",marginBottom:"32px",lineHeight:"1.6"},children:"We appreciate your business and look forward to serving you again."}),e.jsx("div",{style:{padding:"20px",background:"#f1f5f9",borderRadius:"12px",marginBottom:"32px"},children:e.jsx("p",{style:{fontSize:"14px",color:"#64748b",margin:0},children:"Your service has been completed. Have a wonderful day!"})}),e.jsx("button",{onClick:()=>{$e(),t("/")},style:{padding:"12px 32px",borderRadius:"8px",border:"none",background:"#2563eb",color:"white",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s"},onMouseOver:s=>{s.target.style.background="#1e40af"},onMouseOut:s=>{s.target.style.background="#2563eb"},children:"Return to Home"})]})})}function pn(){const[t,i]=n.useState([]),[s,o]=n.useState([]),[a,d]=n.useState(null),[C,h]=n.useState(!0),[p,g]=n.useState(!1),[u,r]=n.useState("youtube"),[S,T]=n.useState(null),P=n.useRef(null),f=n.useRef(null),N=n.useRef(null),y=n.useRef([]);y.current=s;const l=n.useRef([]),D=n.useRef(!1),A=n.useRef([]),R=n.useRef(!1),E=n.useRef(null),H=n.useRef(0),$=8e3,oe=.01,[ee,q]=n.useState(null),ne=n.useRef(null),m=n.useRef(!1),z=n.useRef(null),[Q,U]=n.useState(!1),[de,me]=n.useState(1);n.useEffect(()=>{c(),v();const b=setInterval(c,2e3);return()=>clearInterval(b)},[]),n.useEffect(()=>{Ye()},[]),n.useEffect(()=>{s.length>0&&!m.current&&U(!0)},[s]);const ge=n.useRef(null);n.useEffect(()=>{const b=()=>{var B;return(B=ge.current)==null?void 0:B.call(ge)};return document.addEventListener("keydown",b),()=>document.removeEventListener("keydown",b)},[]),n.useEffect(()=>{s.length>0&&!a&&d(s[0])},[s,a]),n.useEffect(()=>()=>{s.forEach(b=>{b._blobUrl&&b.url&&URL.revokeObjectURL(b.url)})},[s]),n.useEffect(()=>{if(u!=="local"||!P.current||!a)return;const b=P.current,B=()=>{const _=(s.findIndex(X=>X.url===a.url)+1)%s.length;d(s[_])};b.addEventListener("ended",B),b.volume=oe,b.load();const I=b.play();return I!==void 0&&I.then(()=>{b.muted=!1}).catch(()=>{b.muted=!0,b.play().catch(console.error)}),()=>b.removeEventListener("ended",B)},[a,s,u]),n.useEffect(()=>{var _;if(u!=="youtube"||!(a!=null&&a.id))return;const b=X=>{if(f.current){f.current.loadVideoById(X);const W=Math.max(0,Math.min(100,de))/100;f.current.setVolume(Math.round(W*100));return}const K=N.current;if(!K)return;const Z=document.createElement("div");Z.id="youtube-player-"+Date.now(),K.innerHTML="",K.appendChild(Z),f.current=new window.YT.Player(Z.id,{videoId:X,width:"100%",height:"100%",playerVars:{autoplay:1,mute:1,rel:0,modestbranding:1},events:{onReady:W=>{const ie=Math.max(0,Math.min(100,de))/100;W.target.setVolume(Math.round(ie*100)),m.current&&W.target.unMute()},onStateChange:W=>{if(W.data===0){const ie=y.current,le=(ie.findIndex(te=>te.id===X)+1)%ie.length;ie[le]&&d(ie[le])}}}})};if((_=window.YT)!=null&&_.Player)return b(a.id),()=>{};if(window.YTLoadReady)return window.YT.ready(()=>b(a.id)),()=>{};const B=document.createElement("script");B.src="https://www.youtube.com/iframe_api";const I=document.getElementsByTagName("script")[0];I.parentNode.insertBefore(B,I);const Y=window.onYouTubeIframeAPIReady;return window.onYouTubeIframeAPIReady=()=>{window.YTLoadReady=!0,Y&&Y(),b(a.id)},()=>{}},[a,s,u,de]),n.useEffect(()=>()=>{if(f.current){try{f.current.destroy()}catch{}f.current=null}N.current&&(N.current.innerHTML="")},[]);const c=async()=>{try{const B=(await j.get("/queue/public/windows")).data.windows||[],I=l.current;i(B),l.current=B,setTimeout(()=>{try{be(I,B)}catch(Y){console.error("Failed to run TTS announcements:",Y)}},0)}catch(b){console.error("Failed to load windows:",b)}finally{h(!1)}},v=async()=>{try{const B=(await j.get("/admin/settings/ding-sound")).data.dingSoundUrl||null;q(B),ne.current=B}catch(b){console.error("Failed to load ding sound URL:",b),q(null),ne.current=null}},L=b=>{if(typeof window>"u"){console.log("playDing: window undefined"),b&&setTimeout(b,7e3);return}console.log("playDing: starting");let I=!1,Y=null;Y=setTimeout(()=>{if(!I&&(console.warn("playDing: Ultimate timeout reached, forcing safeDone"),I=!0,b))try{b()}catch(X){console.error("playDing: Error in onDone callback:",X)}},7e3);const _=()=>{if(I){console.log("playDing: safeDone called but already done");return}if(I=!0,Y&&(clearTimeout(Y),Y=null),console.log("playDing: done - calling onDone callback"),b)try{b()}catch(X){console.error("playDing: Error in onDone callback:",X)}else console.warn("playDing: No onDone callback provided")};try{const X=ne.current||ee;if(X&&typeof X=="string"){const Z=X.startsWith("http")?X:`${window.location.origin}${X.startsWith("/")?"":"/"}${X}`;console.log("playDing: Using custom ding sound:",Z);const W=new Audio(Z);W.volume=1;let ie=!1;const ce=()=>{if(I)return;console.log("playDing: Trying synthesized chime fallback");const ve=window.AudioContext||window.webkitAudioContext;if(!ve){console.warn("playDing: No AudioContext available"),_();return}let ue=z.current;if(!ue)try{ue=new ve,ue.state,z.current=ue}catch(ye){console.warn("playDing: Cannot create AudioContext (needs user gesture):",ye),I||_();return}if(!ue){console.warn("playDing: No AudioContext available"),I||_();return}const Be=()=>{if(!I)try{console.log("playDing: Playing synthesized chime");const ye=ue.createOscillator(),ze=ue.createOscillator(),Re=ue.createGain();ye.type="sine",ze.type="sine";const x=ue.currentTime;ye.frequency.setValueAtTime(880,x),ze.frequency.setValueAtTime(1175,x+.08),ye.connect(Re),ze.connect(Re),Re.connect(ue.destination),Re.gain.setValueAtTime(1e-4,x),Re.gain.exponentialRampToValueAtTime(.25,x+.03),Re.gain.exponentialRampToValueAtTime(1e-4,x+.4),ye.start(x),ze.start(x+.08),ye.stop(x+.4),ze.stop(x+.4),setTimeout(()=>{I||(console.log("playDing: Synthesized chime finished"),_())},500)}catch(ye){console.error("playDing: Failed to play chime:",ye),I||_()}};ue.state==="suspended"&&ue.resume?ue.resume().then(()=>{I||Be()}).catch(ye=>{console.warn("playDing: AudioContext resume failed:",ye),I||_()}):Be()},le=()=>{if(I)return;console.log("playDing: Audio ended event fired, currentTime:",W.currentTime,"duration:",W.duration),W.removeEventListener("ended",le),W.removeEventListener("error",te),W.removeEventListener("canplaythrough",he),W.removeEventListener("loadeddata",he),W.currentTime>=Math.min(.1,W.duration*.1)||W.duration===0?(console.log("playDing: Custom ding played successfully"),ie=!0,_()):(console.warn("playDing: Custom ding ended immediately, trying fallback chime"),ce())},te=ve=>{console.error("Failed to play custom ding sound:",ve),W.removeEventListener("ended",le),W.removeEventListener("error",te),W.removeEventListener("canplaythrough",he),W.removeEventListener("loadeddata",he),ce()},we=()=>{console.log("playDing: Audio ready, attempting to play, readyState:",W.readyState,"duration:",W.duration,"currentTime:",W.currentTime),W.currentTime=0,setTimeout(()=>{const ve=W.play();ve!==void 0?ve.then(()=>{console.log("playDing: Audio playing successfully, paused:",W.paused,"currentTime:",W.currentTime,"duration:",W.duration),setTimeout(()=>{W.paused&&!I&&!ie?(console.warn("playDing: Audio paused after play() promise resolved, may be blocked by autoplay policy. Will try fallback chime."),te(new Error("Autoplay blocked"))):W.paused||console.log("playDing: Audio confirmed playing, currentTime:",W.currentTime)},100)}).catch(ue=>{console.error("Failed to start custom ding sound:",ue),te(ue)}):(console.warn("playDing: play() returned undefined"),setTimeout(()=>{W.paused&&!I&&!ie&&(console.warn("playDing: Audio is paused after play(), treating as error. Will try fallback chime."),te(new Error("Audio did not start playing")))},100))},10)},he=()=>{W.removeEventListener("canplaythrough",he),W.removeEventListener("loadeddata",he),we()};W.addEventListener("ended",le),W.addEventListener("error",te),W.readyState>=2?(console.log("playDing: Audio already loaded, playing immediately"),we()):(W.addEventListener("canplaythrough",he),W.addEventListener("loadeddata",he),W.load()),setTimeout(()=>{!I&&!ie&&(console.warn("playDing: Custom ding timeout (2s), trying fallback chime"),W.removeEventListener("ended",le),W.removeEventListener("error",te),W.removeEventListener("canplaythrough",he),W.removeEventListener("loadeddata",he),ce())},2e3);return}const K=window.AudioContext||window.webkitAudioContext;if(K){const Z=z.current||new K,W=()=>{console.log("playDing: Playing synthesized chime");const ie=Z.createOscillator(),ce=Z.createOscillator(),le=Z.createGain();ie.type="sine",ce.type="sine";const te=Z.currentTime;ie.frequency.setValueAtTime(880,te),ce.frequency.setValueAtTime(1175,te+.08),ie.connect(le),ce.connect(le),le.connect(Z.destination),le.gain.setValueAtTime(1e-4,te),le.gain.exponentialRampToValueAtTime(.25,te+.03),le.gain.exponentialRampToValueAtTime(1e-4,te+.4),ie.start(te),ce.start(te+.08),ie.stop(te+.4),ce.stop(te+.4),setTimeout(()=>{console.log("playDing: Synthesized chime finished"),_()},500)};Z.state==="suspended"&&Z.resume?Z.resume().then(()=>{W()}).catch(()=>{W()}):W();return}console.warn("playDing: No AudioContext available, cannot play chime"),_()}catch(X){console.error("Failed to play ding sound:",X)}setTimeout(_,7e3)},w=b=>{const B=P.current;B&&(B.volume=Math.max(0,Math.min(1,b)));const I=f.current;I&&typeof I.setVolume=="function"&&I.setVolume(Math.round(Math.max(0,Math.min(1,b))*100))},G=(b,B)=>{if(typeof window<"u"&&window.speechSynthesis){window.speechSynthesis.cancel();const I=new SpeechSynthesisUtterance(b);I.lang="en-US",I.rate=1,I.pitch=1,I.onend=B,I.onerror=B,window.speechSynthesis.speak(I)}else B()},ae=b=>new Promise(B=>{if(!b||typeof b!="string"||!b.trim()){console.warn("TTS: Empty or invalid text provided"),B();return}j.post("/tts",{text:b},{responseType:"arraybuffer"}).then(I=>{const Y=I.headers&&I.headers["content-type"]||"",_=Y.includes("audio/")||Y.includes("mpeg");if(I.status!==200||!_||!I.data){console.warn("TTS: Invalid response, falling back to speechSynthesis"),G(b,B);return}const X=I.data,K=new Blob([X],{type:"audio/mpeg"}),Z=URL.createObjectURL(K),W=new Audio(Z);W.volume=1;const ie=()=>{W.src="",W.removeEventListener("ended",ce),W.removeEventListener("error",le),setTimeout(()=>URL.revokeObjectURL(Z),100)},ce=()=>{ie(),B()},le=we=>{console.error("TTS audio playback error:",we),ie(),G(b,B)};W.addEventListener("ended",ce),W.addEventListener("error",le);const te=W.play();te!==void 0&&te.catch(we=>{console.error("TTS audio play() failed:",we),ie(),G(b,B)})}).catch(I=>{console.error("TTS API call failed:",I),G(b,B)})}),fe=()=>new Promise(b=>L(b)),pe=async()=>{if(R.current){console.log("Already processing announcement, skipping");return}if(A.current.length===0){console.log("No announcements in queue");return}console.log(`Processing announcement, queue length: ${A.current.length}`),R.current=!0;const b=A.current.shift();if(!b){console.log("No item to process"),R.current=!1,A.current.length>0&&pe();return}const{text:B}=b;console.log("Starting announcement:",B);try{w(.05),console.log("Playing ding..."),await fe(),console.log("Ding finished, playing TTS..."),await ae(B),console.log("TTS finished"),Ee(b.key)}catch(I){console.error("Announcement playback error:",I)}finally{w(oe),R.current=!1,A.current.length>0&&pe()}},be=(b,B)=>{if(typeof window>"u")return;if(!D.current){D.current=!0;return}const I=new Map;(b||[]).forEach(K=>{K&&K.id&&K.currentServing&&I.set(K.id,K.currentServing.queueNumber)});const Y=Date.now(),_=new Set(A.current.map(K=>K.key).filter(Boolean)),X=[];(B||[]).forEach(K=>{if(!K||!K.id||!K.currentServing)return;const Z=K.currentServing.queueNumber,W=K.currentServing.clientName,ie=I.get(K.id);if(!Z||Z===ie)return;const ce=`${K.id}:${Z}`;if(_.has(ce)||E.current===ce&&Y-H.current<$)return;_.add(ce);const le=et?et(Z):Z;let te=le;const we=parseInt(le,10);Number.isNaN(we)||(te=String(we));const he=K.label||"Window",ve=W?`, ${W}`:"",Be="Ang atong {{window}},... mu assist na sa kyu number, {{queueNumber}}. {{clientNamePart}}, please proceed to {{window}}.".replace(/{{\s*window\s*}}/gi,he).replace(/{{\s*queueNumber\s*}}/gi,te).replace(/{{\s*clientNamePart\s*}}/gi,ve);console.log("Announcement queued:",{windowLabel:he,spokenCounter:te,text:Be}),X.push({text:Be,key:ce})}),X.length>0&&(console.log(`Adding ${X.length} announcement(s) to queue`),X.forEach(K=>A.current.push(K)),pe())},Ee=b=>{b&&(E.current=b,H.current=Date.now())},Te=[".mp4",".webm",".ogg",".mov",".avi"];function Ue(b){if(!b||typeof b!="string")return null;const B=b.trim(),I=B.match(/[?&]v=([^&]+)/);if(I)return I[1];const Y=B.match(/youtu\.be\/([^?&]+)/);if(Y)return Y[1];const _=B.match(/youtube\.com\/embed\/([^?&]+)/);return _?_[1]:null}const Ye=async()=>{var b;try{const[B,I]=await Promise.all([j.get("/admin/settings/video-source"),j.get("/admin/settings/video-volume").catch(()=>null)]),Y=B.data.videoSource||"youtube";if(r(Y),I&&typeof((b=I.data)==null?void 0:b.videoVolumePercent)=="number"){const _=I.data.videoVolumePercent;me(Math.max(0,Math.min(100,Math.round(_))))}if(Y==="youtube"){const K=((await j.get("/admin/settings/youtube-playlist")).data.urls||[]).map(Z=>{const W=Ue(Z);return W?{id:W,url:Z,name:W}:null}).filter(Boolean);o(K),g(!1),T(null)}else o([]),T(null)}catch(B){console.error("Failed to load videos:",B),g(!0),o([])}},_e=async()=>{if(!("showDirectoryPicker"in window)){T("Not supported in this browser. Use Chrome or Edge.");return}try{T(null);const b=await window.showDirectoryPicker(),B=[];for await(const I of b.values())if(I.kind==="file"){const Y="."+(I.name.split(".").pop()||"").toLowerCase();if(Te.includes(Y)){const _=await I.getFile(),X=URL.createObjectURL(_);B.push({filename:I.name,name:I.name.replace(/\.[^/.]+$/,""),url:X,_blobUrl:!0})}}B.length>0?(o(B),g(!1)):T("No video files found in that folder.")}catch(b){b.name!=="AbortError"&&(console.error("Failed to pick folder:",b),T(b.message||"Failed to access folder."))}},De=()=>{if(!m.current){m.current=!0,U(!1);try{const b=Math.max(0,Math.min(100,de))/100,B=window.AudioContext||window.webkitAudioContext;if(B&&!z.current){const _=new B;z.current=_,_.resume&&_.resume()}const I=f.current;I&&typeof I.unMute=="function"&&(I.unMute(),I.setVolume(Math.round(b*100)));const Y=P.current;Y&&(Y.muted=!1,Y.volume=b)}catch{}}};return ge.current=De,e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",background:"#0f172a",overflow:"hidden"},onClick:De,onTouchStart:De,role:"presentation",children:[Q&&s.length>0&&e.jsxs("div",{role:"button",tabIndex:0,onClick:De,onKeyDown:b=>{b.key!=="Tab"&&De()},style:{position:"fixed",inset:0,zIndex:9999,background:"rgba(0,0,0,0.7)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"16px",cursor:"pointer"},children:[e.jsx("div",{style:{color:"#e5e7eb",fontSize:"24px",fontWeight:600,textAlign:"center",padding:"0 24px"},children:"Press any key or tap to start"}),e.jsx("div",{style:{color:"#9ca3af",fontSize:"16px",textAlign:"center",padding:"0 24px"},children:"Use your remote's OK/Enter button, or tap the screen"})]}),e.jsxs("div",{style:{flex:1,display:"flex",minHeight:0},children:[e.jsxs("div",{style:{flex:3,minWidth:0,background:"#000",position:"relative",display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("div",{style:{position:"absolute",top:16,left:16,zIndex:10,display:"flex",alignItems:"center",gap:"8px",pointerEvents:"none"},children:e.jsx(Ie,{size:"monitor",showText:!1,showTitle:!0,variant:"monitor",gap:"8px"})}),e.jsx("div",{style:{position:"absolute",bottom:42,left:16,zIndex:10,fontSize:"12px",color:"rgba(255,255,255,0.7)",pointerEvents:"none"},children:"Powered by: CreativeDevLabs"}),s.length>0&&!p?u==="youtube"?e.jsx("div",{ref:N,style:{position:"relative",width:"100%",height:"100%"}}):e.jsx("video",{ref:P,src:a==null?void 0:a.url,controls:!0,autoPlay:!0,muted:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsxs("div",{style:{textAlign:"center",padding:"40px",display:"flex",flexDirection:"column",alignItems:"center",gap:"16px"},children:[e.jsx("div",{style:{color:"#9ca3af",fontSize:"22px",fontWeight:600,marginBottom:"8px"},children:u==="local"?"Select a video folder":"No YouTube playlist configured"}),e.jsx("div",{style:{color:"#6b7280",fontSize:"16px"},children:u==="local"?"Choose a folder on this computer containing video files (mp4, webm, ogg, mov, avi).":"Add YouTube URLs in Admin â†’ Settings â†’ Videos."}),u==="local"&&S&&e.jsx("div",{style:{color:"#ef4444",fontSize:"14px"},children:S}),u==="local"&&e.jsx("button",{type:"button",onClick:_e,style:{padding:"12px 24px",fontSize:"16px",fontWeight:600,color:"white",background:"#6366f1",border:"none",borderRadius:"8px",cursor:"pointer"},children:"Select folder"})]})]}),e.jsx("div",{style:{flex:1,minWidth:0,borderLeft:"1px solid #1f2937",background:"#020617",padding:"12px",display:"flex",flexDirection:"column",gap:"12px",overflowY:"auto"},children:C?e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ke,{})}):(()=>{const b=t.filter(Y=>Y.staff);if(b.length===0)return e.jsx("div",{style:{textAlign:"center",padding:"24px 16px",background:"#0b1120",borderRadius:"12px",color:"#64748b",border:"1px solid #1f2937"},children:"No active windows at the moment"});const B=b.length,I=B<=3?"0 0 20vh":"1 1 0";return b.map(Y=>e.jsx("div",{style:{flex:I,minHeight:B>3?0:void 0,display:"flex"},children:e.jsx(Tt,{window:Y,compact:B>3})},Y.id))})()})]})]})}function un(){const t=Ce(),[i]=Pt(),s=i.get("reason")==="logout_6pm",[o,a]=n.useState({username:"",password:""}),[d,C]=n.useState(""),[h,p]=n.useState(!1);n.useEffect(()=>{const u=localStorage.getItem("token"),r=Ae();u&&(r==null?void 0:r.role)==="STAFF"&&t("/staff/dashboard")},[t]);const g=async u=>{var r,S;u.preventDefault(),C(""),p(!0);try{const T=await j.post("/auth/staff/login",o);localStorage.setItem("token",T.data.token),localStorage.setItem("user",JSON.stringify(T.data.user)),t("/staff/dashboard")}catch(T){C(((S=(r=T.response)==null?void 0:r.data)==null?void 0:S.error)||"Login failed")}finally{p(!1)}};return e.jsxs("div",{className:"staff-login-root",style:{minHeight:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",padding:"20px",paddingLeft:"max(20px, env(safe-area-inset-left))",paddingRight:"max(20px, env(safe-area-inset-right))"},children:[e.jsx("style",{children:`
        @media (max-width: 480px) {
          .staff-login-root { padding: 16px !important; }
          .staff-login-card { padding: 24px !important; }
          .staff-login-title { font-size: 22px !important; }
        }
      `}),e.jsxs("div",{className:"staff-login-card",style:{background:"white",borderRadius:"16px",padding:"40px",maxWidth:"400px",width:"100%",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[e.jsx("div",{style:{marginBottom:"24px",display:"flex",justifyContent:"center"},children:e.jsx(Ie,{size:"medium",titlePosition:"below",align:"center"})}),e.jsx("h1",{className:"staff-login-title",style:{fontSize:"28px",fontWeight:"700",marginBottom:"8px",color:"#1e293b",textAlign:"center"},children:"Staff Login"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",textAlign:"center",marginBottom:"32px"},children:"Sign in to manage your queue"}),s&&e.jsx("div",{style:{padding:"12px",background:"#fef3c7",color:"#92400e",borderRadius:"8px",marginBottom:"16px",fontSize:"14px"},children:"You were automatically logged out. Staff sessions end at 6pm."}),e.jsxs("form",{onSubmit:g,children:[e.jsx(re,{label:"Username",value:o.username,onChange:u=>a({...o,username:u.target.value}),placeholder:"Enter your username",required:!0,autoFocus:!0}),e.jsx(re,{label:"Password",type:"password",value:o.password,onChange:u=>a({...o,password:u.target.value}),placeholder:"Enter your password",required:!0}),d&&e.jsx("div",{style:{padding:"12px",background:"#fee2e2",color:"#991b1b",borderRadius:"8px",marginBottom:"16px",fontSize:"14px"},children:d}),e.jsx(M,{type:"submit",fullWidth:!0,disabled:h,children:h?"Logging in...":"Login"})]})]})]})}function tt({label:t,error:i,children:s,...o}){return e.jsxs("div",{style:{marginBottom:"16px"},children:[t&&e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500",color:"#1e293b"},children:t}),e.jsx("select",{style:{width:"100%",padding:"12px",borderRadius:"8px",border:i?"2px solid #ef4444":"2px solid #e2e8f0",fontSize:"16px",backgroundColor:"white",cursor:"pointer"},...o,children:s}),i&&e.jsx("div",{style:{marginTop:"4px",fontSize:"12px",color:"#ef4444"},children:i})]})}function xn({onProfileClick:t,onLogout:i}){const[s,o]=n.useState(!1),[a,d]=n.useState(null),[C,h]=n.useState(!0),p=n.useRef(null);n.useEffect(()=>{g()},[]),n.useEffect(()=>{const r=S=>{p.current&&!p.current.contains(S.target)&&o(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[]);const g=async()=>{try{const r=await j.get("/staff/profile");d(r.data.staff)}catch(r){console.error("Failed to load profile:",r)}finally{h(!1)}},u=r=>{if(!r)return"?";const S=r.trim().split(" ");return S.length>=2?(S[0][0]+S[S.length-1][0]).toUpperCase():r.substring(0,2).toUpperCase()};return C?e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:"#e2e8f0"}}):e.jsxs("div",{style:{position:"relative"},ref:p,children:[e.jsx("button",{onClick:()=>o(!s),style:{width:"44px",height:"44px",minWidth:"44px",minHeight:"44px",borderRadius:"50%",border:"2px solid #e2e8f0",background:a!=null&&a.profilePicture?`url(${a.profilePicture}) center/cover`:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",fontWeight:"700",fontSize:"14px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",padding:0,transition:"all 0.2s"},onMouseOver:r=>{r.target.style.borderColor="#2563eb",r.target.style.transform="scale(1.05)"},onMouseOut:r=>{r.target.style.borderColor="#e2e8f0",r.target.style.transform="scale(1)"},children:!(a!=null&&a.profilePicture)&&u(a==null?void 0:a.name)}),s&&e.jsxs("div",{style:{position:"absolute",top:"48px",right:0,background:"white",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",minWidth:"160px",zIndex:1e3,border:"1px solid #e2e8f0",overflow:"hidden"},children:[e.jsx("div",{style:{padding:"12px 16px",borderBottom:"1px solid #e2e8f0",fontSize:"14px",fontWeight:"600",color:"#1e293b"},children:(a==null?void 0:a.name)||"Staff"}),e.jsxs("button",{onClick:()=>{o(!1),t()},style:{width:"100%",padding:"14px 16px",minHeight:"44px",border:"none",background:"transparent",textAlign:"left",fontSize:"14px",color:"#1e293b",cursor:"pointer",transition:"background 0.2s",display:"flex",alignItems:"center",gap:"10px"},onMouseOver:r=>{r.currentTarget.style.background="#f1f5f9"},onMouseOut:r=>{r.currentTarget.style.background="transparent"},children:[e.jsx(ht,{size:18}),"Profile"]}),e.jsxs("button",{onClick:()=>{o(!1),i()},style:{width:"100%",padding:"14px 16px",minHeight:"44px",border:"none",background:"transparent",textAlign:"left",fontSize:"14px",color:"#ef4444",cursor:"pointer",transition:"background 0.2s",display:"flex",alignItems:"center",gap:"10px"},onMouseOver:r=>{r.currentTarget.style.background="#fee2e2"},onMouseOut:r=>{r.currentTarget.style.background="transparent"},children:[e.jsx(mt,{size:18}),"Logout"]})]})]})}const ut={success:{icon:rt,color:"#10b981",bg:"#d1fae5"},error:{icon:Bt,color:"#ef4444",bg:"#fee2e2"},warning:{icon:Et,color:"#f59e0b",bg:"#fef3c7"},info:{icon:At,color:"#2563eb",bg:"#dbeafe"}};let gn=0;const Fe=[],Ve=[];function zt(t,i="info",s=3e3){const o=gn++,a={id:o,message:t,type:i,duration:s};return Fe.push(a),Ve.forEach(d=>d([...Fe])),s>0&&setTimeout(()=>{Rt(o)},s),o}function Rt(t){const i=Fe.findIndex(s=>s.id===t);i>-1&&(Fe.splice(i,1),Ve.forEach(s=>s([...Fe])))}function J(t,i){return zt(t,"success",i)}function F(t,i){return zt(t,"error",i)}function fn(){const[t,i]=n.useState([]);return n.useEffect(()=>{const s=o=>{i(o)};return Ve.push(s),i([...Fe]),()=>{const o=Ve.indexOf(s);o>-1&&Ve.splice(o,1)}},[]),e.jsxs("div",{style:{position:"fixed",top:"20px",right:"20px",zIndex:1e4,display:"flex",flexDirection:"column",gap:"12px",pointerEvents:"none"},children:[(t||[]).map(s=>{const o=ut[s.type]||ut.info,a=o.icon;return e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"16px 20px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",display:"flex",alignItems:"center",gap:"12px",minWidth:"300px",maxWidth:"400px",pointerEvents:"auto",animation:"slideIn 0.3s ease-out",borderLeft:`4px solid ${o.color}`},children:[e.jsx("div",{style:{width:"24px",height:"24px",borderRadius:"50%",background:o.bg,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(a,{size:16,color:o.color})}),e.jsx("div",{style:{flex:1,fontSize:"14px",color:"#1e293b",lineHeight:"1.5"},children:s.message}),e.jsx("button",{onClick:()=>Rt(s.id),style:{background:"none",border:"none",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center",color:"#64748b",transition:"color 0.2s"},onMouseOver:d=>{d.target.style.color="#1e293b"},onMouseOut:d=>{d.target.style.color="#64748b"},children:e.jsx(xe,{size:18})})]},s.id)}),e.jsx("style",{children:`
        @keyframes slideIn {
          from {
            transform: translateX(100%);
            opacity: 0;
          }
          to {
            transform: translateX(0);
            opacity: 1;
          }
        }
      `})]})}function Le({open:t,title:i,message:s,onConfirm:o,onCancel:a,confirmText:d="Confirm",cancelText:C="Cancel",variant:h="danger"}){if(!t)return null;const p={danger:{confirmBg:"#ef4444",confirmHover:"#dc2626"},warning:{confirmBg:"#f59e0b",confirmHover:"#d97706"},info:{confirmBg:"#2563eb",confirmHover:"#1e40af"}},g=p[h]||p.danger;return e.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,animation:"fadeIn 0.2s ease-out"},children:[e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",maxWidth:"400px",width:"90%",boxShadow:"0 10px 25px rgba(0,0,0,0.2)",animation:"slideUp 0.3s ease-out"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"#1e293b",margin:0},children:i}),e.jsx("button",{onClick:a,style:{background:"none",border:"none",cursor:"pointer",padding:"4px",color:"#64748b",display:"flex",alignItems:"center"},children:e.jsx(xe,{size:20})})]}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"24px",lineHeight:"1.6"},children:s}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:a,style:{padding:"10px 20px",border:"2px solid #e2e8f0",borderRadius:"8px",background:"transparent",color:"#64748b",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s"},onMouseOver:u=>{u.target.style.background="#f1f5f9",u.target.style.borderColor="#cbd5e1"},onMouseOut:u=>{u.target.style.background="transparent",u.target.style.borderColor="#e2e8f0"},children:C}),e.jsx("button",{onClick:o,style:{padding:"10px 20px",border:"none",borderRadius:"8px",background:g.confirmBg,color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},onMouseOver:u=>{u.target.style.background=g.confirmHover,u.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.2)"},onMouseOut:u=>{u.target.style.background=g.confirmBg,u.target.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)"},children:d})]})]}),e.jsx("style",{children:`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes slideUp {
          from {
            transform: translateY(20px);
            opacity: 0;
          }
          to {
            transform: translateY(0);
            opacity: 1;
          }
        }
      `})]})}const xt=["#2563eb","#10b981","#f59e0b","#ef4444"];function hn(){const t=Ce(),[i,s]=n.useState(!0),[o,a]=n.useState(null),[d,C]=n.useState([]),[h,p]=n.useState({}),[g,u]=n.useState([]),[r,S]=n.useState(null),[T,P]=n.useState("today"),[f,N]=n.useState(new Date),[y,l]=n.useState({open:!1,queueEntryId:null}),[D,A]=n.useState(null);n.useEffect(()=>{const c=localStorage.getItem("token"),v=Ae();if(!c||(v==null?void 0:v.role)!=="STAFF"){t("/staff/login");return}R(),E();const L=setInterval(R,3e3);return()=>clearInterval(L)},[t]),n.useEffect(()=>{T&&H()},[T]),n.useEffect(()=>{const c=setInterval(()=>N(new Date),1e3);return()=>clearInterval(c)},[]);const R=async()=>{var c;try{const v=await j.get("/staff/dashboard");a(v.data.window),C(v.data.queue||[]),p(v.data.stats||{})}catch(v){console.error("Failed to load dashboard:",v),((c=v.response)==null?void 0:c.status)===401&&t("/staff/login")}finally{s(!1)}},E=async()=>{try{const c=await j.get("/windows/active");u(c.data.windows||[])}catch(c){console.error("Failed to load windows:",c)}},H=async()=>{try{let c,v;const L=new Date;if(T==="today")c=L.toISOString().split("T")[0],v=c;else if(T==="yesterday"){const G=new Date(L);G.setDate(G.getDate()-1),c=G.toISOString().split("T")[0],v=c}else c=L.toISOString().split("T")[0],v=c;const w=await j.get(`/staff/analytics?startDate=${c}&endDate=${v}`);S(w.data)}catch(c){console.error("Failed to load analytics:",c)}},$=async c=>{var v,L;try{await j.post("/staff/assign-window",{windowId:c}),R(),E()}catch(w){console.error("Failed to assign window:",w),alert(((L=(v=w.response)==null?void 0:v.data)==null?void 0:L.error)||"Failed to assign window")}},oe=async c=>{var v,L,w,G,ae,fe;if(!D){A(c);try{const be=(v=(await j.post(`/staff/serve/${c}`)).data)==null?void 0:v.queueEntry;be?C(Ee=>Ee.map(Te=>Te.id===c?be:Te)):R()}catch(pe){console.error("Failed to start serving:",pe),((L=pe.response)==null?void 0:L.status)===409?(F(((G=(w=pe.response)==null?void 0:w.data)==null?void 0:G.error)||"Client was already claimed. Refreshing..."),R()):F(((fe=(ae=pe.response)==null?void 0:ae.data)==null?void 0:fe.error)||"Failed to start serving")}finally{A(null)}}},ee=async c=>{var v,L;try{await j.post(`/staff/complete/${c}`),R(),H()}catch(w){console.error("Failed to complete:",w),alert(((L=(v=w.response)==null?void 0:v.data)==null?void 0:L.error)||"Failed to complete")}},q=c=>{l({open:!0,queueEntryId:c})},ne=async()=>{var v,L;const{queueEntryId:c}=y;if(l({open:!1,queueEntryId:null}),!!c)try{await j.post(`/staff/skip/${c}`),R(),H(),J("Client marked as skipped")}catch(w){console.error("Failed to skip:",w),F(((L=(v=w.response)==null?void 0:v.data)==null?void 0:L.error)||"Failed to skip")}},m=async()=>{try{await j.get("/staff/dashboard").then(v=>v.data.window)&&await j.post("/staff/assign-window",{windowId:null})}catch(c){console.error("Error deactivating window on logout:",c)}localStorage.removeItem("token"),localStorage.removeItem("user"),t("/staff/login")},z=()=>{t("/staff/profile")};if(i)return e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ke,{})});const Q=d.filter(c=>["SENIOR_CITIZEN","PWD","PREGNANT"].includes(c.clientType)),U=d.filter(c=>c.clientType==="REGULAR"),de=r!=null&&r.byCategory?Object.entries(r.byCategory).map(([c,v])=>({name:c,value:v})):[],me=r!=null&&r.byClientType?Object.entries(r.byClientType).map(([c,v])=>({name:c,value:v})):[],ge=c=>{const v=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],L=["January","February","March","April","May","June","July","August","September","October","November","December"],w=v[c.getDay()],G=L[c.getMonth()],ae=c.getDate(),fe=c.getFullYear();let pe=c.getHours();const be=String(c.getMinutes()).padStart(2,"0"),Ee=String(c.getSeconds()).padStart(2,"0"),Te=pe>=12?"PM":"AM";return pe=pe%12,pe=pe||12,`${w}, ${G} ${ae}, ${fe} at ${pe}:${be}:${Ee} ${Te}`};return e.jsxs(e.Fragment,{children:[e.jsx(Le,{open:y.open,title:"Skip Client",message:"Mark this client as skipped? They will be removed from the queue and not counted as served.",confirmText:"Skip",cancelText:"Cancel",variant:"warning",onConfirm:ne,onCancel:()=>l({open:!1,queueEntryId:null})}),e.jsx("style",{children:`
        .staff-dashboard-root {
          padding-left: env(safe-area-inset-left);
          padding-right: env(safe-area-inset-right);
        }
        .staff-dashboard-content {
          padding-left: max(24px, env(safe-area-inset-left));
          padding-right: max(24px, env(safe-area-inset-right));
        }
        .queue-item-buttons button {
          min-height: 44px;
        }
        @media (max-width: 768px) {
          .staff-dashboard-header {
            flex-wrap: wrap;
            gap: 12px;
            padding: 12px 16px !important;
            padding-left: max(16px, env(safe-area-inset-left)) !important;
            padding-right: max(16px, env(safe-area-inset-right)) !important;
          }
          .staff-dashboard-header > div:first-child {
            width: 100%;
            flex-direction: column;
            align-items: flex-start !important;
            gap: 8px !important;
          }
          .staff-dashboard-header-center {
            width: 100%;
            text-align: left;
          }
          .staff-dashboard-main-grid {
            grid-template-columns: 1fr !important;
          }
          .staff-dashboard-content {
            padding: 16px !important;
            padding-left: max(16px, env(safe-area-inset-left)) !important;
            padding-right: max(16px, env(safe-area-inset-right)) !important;
          }
          .queue-item-grid {
            grid-template-columns: 1fr !important;
            gap: 12px !important;
          }
          .queue-item-buttons {
            flex-direction: row !important;
            width: 100% !important;
            flex-wrap: wrap;
          }
          .queue-item-buttons button {
            flex: 1;
            min-width: 120px;
          }
          .staff-window-assign-grid {
            grid-template-columns: 1fr !important;
          }
        }
        @media (max-width: 480px) {
          .queue-item-buttons {
            flex-direction: column !important;
          }
          .queue-item-buttons button {
            min-width: 100%;
          }
        }
        @media (max-width: 1024px) and (min-width: 769px) {
          .staff-dashboard-main-grid {
            grid-template-columns: 60% 40% !important;
          }
        }
      `}),e.jsxs("div",{className:"staff-dashboard-root",style:{minHeight:"100vh",background:"#f8fafc"},children:[e.jsxs("div",{className:"staff-dashboard-header",style:{background:"white",borderBottom:"1px solid #e2e8f0",padding:"16px 24px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(Ie,{size:"small"}),e.jsx("div",{style:{flex:1}}),o&&e.jsxs("div",{className:"staff-dashboard-header-center",style:{fontSize:"18px",fontWeight:"600",color:"#1e293b",marginRight:"30px"},children:["Operating: ",o.label]}),e.jsx(xn,{onProfileClick:z,onLogout:m})]}),e.jsxs("div",{className:"staff-dashboard-content",style:{maxWidth:"1400px",margin:"0 auto",padding:"24px"},children:[e.jsx("div",{style:{marginBottom:"24px"},children:e.jsx("div",{style:{fontSize:"18px",fontWeight:"600",color:"#1e293b"},children:ge(f)})}),!o&&e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",marginBottom:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("h2",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"Assign Window"}),e.jsx("div",{className:"staff-window-assign-grid",style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"12px"},children:g.map(c=>e.jsx(M,{onClick:()=>$(c.id),variant:"outline",children:c.label},c.id))})]}),e.jsxs("div",{className:"staff-dashboard-main-grid",style:{display:"grid",gridTemplateColumns:"75% 25%",gap:"24px"},children:[e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsxs("h2",{style:{fontSize:"20px",fontWeight:"600",marginBottom:"20px"},children:["Queue (",d.length,")"]}),Q.length>0&&e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:"#f59e0b",marginBottom:"12px"},children:"Priority Clients"}),Q.map(c=>e.jsx(gt,{entry:c,onServe:oe,onComplete:ee,onSkip:q,servingId:D},c.id))]}),U.length>0&&e.jsxs("div",{children:[Q.length>0&&e.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:"#64748b",marginBottom:"12px"},children:"Regular Clients"}),U.map(c=>e.jsx(gt,{entry:c,onServe:oe,onComplete:ee,onSkip:q,servingId:D},c.id))]}),d.length===0&&e.jsx("div",{style:{textAlign:"center",padding:"40px",color:"#94a3b8"},children:"No clients in queue"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"24px"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("div",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px"},children:"In Queue"}),e.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:"#f59e0b"},children:d.length})]}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("div",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px"},children:"Total Served Today"}),e.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:"#2563eb"},children:h.totalServed||0})]}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("div",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px"},children:"Skipped Today"}),e.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:"#ef4444"},children:h.totalSkipped||0})]})]}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h2",{style:{fontSize:"20px",fontWeight:"600"},children:"Analytics"}),e.jsxs(tt,{value:T,onChange:c=>P(c.target.value),style:{width:"100%"},children:[e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"yesterday",children:"Yesterday"})]})]}),r&&e.jsxs(e.Fragment,{children:[de.length>0&&e.jsxs("div",{style:{marginBottom:"32px"},children:[e.jsx("h3",{style:{fontSize:"14px",fontWeight:"600",marginBottom:"12px"},children:"By Category"}),e.jsx(Oe,{width:"100%",height:200,children:e.jsxs(it,{data:de,children:[e.jsx(Qe,{strokeDasharray:"3 3"}),e.jsx(Ke,{dataKey:"name"}),e.jsx(Je,{}),e.jsx(Me,{}),e.jsx(st,{dataKey:"value",fill:"#2563eb"})]})})]}),me.length>0&&e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"14px",fontWeight:"600",marginBottom:"12px"},children:"By Client Type"}),e.jsx(Oe,{width:"100%",height:200,children:e.jsxs(St,{children:[e.jsx(Ct,{data:me,cx:"50%",cy:"50%",labelLine:!1,label:({name:c,percent:v})=>`${c}: ${(v*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:me.map((c,v)=>e.jsx(kt,{fill:xt[v%xt.length]},`cell-${v}`))}),e.jsx(Me,{})]})})]})]})]})]})]})]})]})]})}function gt({entry:t,onServe:i,onComplete:s,onSkip:o,servingId:a}){var h,p,g;const d=t.status==="NOW_SERVING",C=a===t.id;return e.jsxs("div",{className:"queue-item-grid",style:{padding:"16px",border:d?"2px solid #2563eb":"1px solid #e2e8f0",borderRadius:"8px",marginBottom:"12px",background:d?"#eff6ff":"white",display:"grid",gridTemplateColumns:"1fr auto",gap:"20px",alignItems:"start"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap",marginBottom:"6px"},children:[e.jsx("span",{style:{fontSize:"18px",fontWeight:"700",color:"#2563eb"},children:t.queueNumber}),e.jsx("span",{style:{fontSize:"20px",fontWeight:"bold",color:"#1e293b",textTransform:"uppercase"},children:t.clientName}),e.jsx(Dt,{clientType:t.clientType})]}),e.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center",flexWrap:"wrap",fontSize:"14px"},children:[e.jsxs("span",{style:{color:"#64748b"},children:[((h=t.concernCategories)!=null&&h.length?t.concernCategories:t.category?[t.category]:[]).map(u=>u==null?void 0:u.name).filter(Boolean).join(", "),((p=t.concernSubCategories)!=null&&p.length?t.concernSubCategories:t.subCategory?[t.subCategory]:[]).map(u=>u==null?void 0:u.name).filter(Boolean).length>0&&` - ${((g=t.concernSubCategories)!=null&&g.length?t.concernSubCategories:[t.subCategory]).map(u=>u==null?void 0:u.name).filter(Boolean).join(", ")}`]}),e.jsxs("span",{style:{color:"#94a3b8"},children:["Joined: ",new Date(t.joinedAt).toLocaleTimeString()]})]})]}),e.jsxs("div",{className:"queue-item-buttons",style:{display:"flex",gap:"8px"},children:[d?e.jsx(M,{variant:"success",icon:rt,onClick:()=>s(t.id),style:{fontSize:"12px",padding:"8px 16px",whiteSpace:"nowrap"},children:"Mark as Served"}):e.jsx(M,{variant:"primary",icon:Nt,onClick:()=>i(t.id),disabled:C,style:{fontSize:"12px",padding:"8px 16px",whiteSpace:"nowrap"},children:C?"Serving...":"Start Serving"}),e.jsx(M,{variant:"danger",icon:Lt,onClick:()=>o(t.id),style:{fontSize:"12px",padding:"8px 16px",whiteSpace:"nowrap"},children:"Skip"})]})]})}function mn(){const t=Ce(),[i,s]=n.useState(!0),[o,a]=n.useState(!1),[d,C]=n.useState(null),[h,p]=n.useState(null),[g,u]=n.useState(null),[r,S]=n.useState(!1),[T,P]=n.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[f,N]=n.useState(!1),[y,l]=n.useState(null),[D,A]=n.useState([]),[R,E]=n.useState(""),[H,$]=n.useState(!1),[oe,ee]=n.useState(!1);n.useEffect(()=>{const c=localStorage.getItem("token"),v=Ae();if(!c||(v==null?void 0:v.role)!=="STAFF"){t("/staff/login");return}q()},[t]);const q=async()=>{var c;try{const v=await j.get("/staff/profile");C(v.data.staff),p(v.data.staff.profilePicture);const L=v.data.currentWindow||null;l(L),E((L==null?void 0:L.id)||"")}catch(v){console.error("Failed to load profile:",v),((c=v.response)==null?void 0:c.status)===401&&t("/staff/login")}finally{s(!1)}},ne=async()=>{try{const c=await j.get("/windows/active");A(c.data.windows||[])}catch(c){console.error("Failed to load windows:",c)}};n.useEffect(()=>{ne()},[]);const m=async c=>{var v,L;if(c.preventDefault(),!R||R===(y==null?void 0:y.id)){R===(y==null?void 0:y.id)&&F("You are already assigned to this window");return}$(!0);try{await j.post("/staff/assign-window",{windowId:R});const w=D.find(G=>G.id===R);l(w?{id:w.id,label:w.label}:null),J("Window changed successfully. You are now operating at "+((w==null?void 0:w.label)||"the selected window")+".")}catch(w){console.error("Failed to switch window:",w),F(((L=(v=w.response)==null?void 0:v.data)==null?void 0:L.error)||"Failed to switch window")}finally{$(!1)}},z=async()=>{var c,v;ee(!0);try{await j.delete("/staff/profile/picture"),p(null),u(null),C(L=>L?{...L,profilePicture:null}:null),J("Profile picture removed. Your initials will be shown instead.")}catch(L){console.error("Failed to remove picture:",L),F(((v=(c=L.response)==null?void 0:c.data)==null?void 0:v.error)||"Failed to remove picture")}finally{ee(!1)}},Q=c=>{const v=c.target.files[0];if(v){const L=new FileReader;L.onloadend=()=>{u(L.result)},L.readAsDataURL(v),p(v)}},U=async c=>{var v,L;c.preventDefault(),a(!0);try{if(await j.put("/staff/profile",{name:d.name}),h instanceof File){const w=new FormData;w.append("picture",h);const G=await j.post("/staff/profile/picture",w,{headers:{"Content-Type":"multipart/form-data"}});p(G.data.profilePicture),u(null)}J("Profile updated successfully!"),t("/staff/dashboard")}catch(w){console.error("Failed to update profile:",w),F(((L=(v=w.response)==null?void 0:v.data)==null?void 0:L.error)||"Failed to update profile")}finally{a(!1)}},de=async c=>{var v,L;if(c.preventDefault(),T.newPassword!==T.confirmPassword){F("New passwords do not match");return}if(T.newPassword.length<6){F("Password must be at least 6 characters");return}N(!0);try{await j.post("/staff/profile/change-password",{currentPassword:T.currentPassword,newPassword:T.newPassword}),J("Password changed successfully!"),S(!1),P({currentPassword:"",newPassword:"",confirmPassword:""})}catch(w){console.error("Failed to change password:",w),F(((L=(v=w.response)==null?void 0:v.data)==null?void 0:L.error)||"Failed to change password")}finally{N(!1)}};if(i)return e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ke,{})});const me=c=>{if(!c)return"?";const v=c.trim().split(" ");return v.length>=2?(v[0][0]+v[v.length-1][0]).toUpperCase():c.substring(0,2).toUpperCase()},ge=g||(d!=null&&d.profilePicture?d.profilePicture:null);return e.jsxs("div",{className:"staff-profile-root",style:{minHeight:"100vh",background:"#f8fafc"},children:[e.jsx("style",{children:`
        .staff-profile-root {
          padding-left: env(safe-area-inset-left);
          padding-right: env(safe-area-inset-right);
        }
        @media (max-width: 768px) {
          .staff-profile-header {
            flex-wrap: wrap;
            gap: 12px;
            padding: 12px 16px !important;
            padding-left: max(16px, env(safe-area-inset-left)) !important;
            padding-right: max(16px, env(safe-area-inset-right)) !important;
          }
          .staff-profile-content {
            margin: 24px auto !important;
            padding: 0 16px !important;
            padding-left: max(16px, env(safe-area-inset-left)) !important;
            padding-right: max(16px, env(safe-area-inset-right)) !important;
          }
          .staff-profile-card {
            padding: 24px !important;
          }
          .staff-profile-buttons {
            flex-direction: column !important;
          }
          .staff-profile-buttons button {
            width: 100%;
          }
        }
      `}),e.jsxs("div",{className:"staff-profile-header",style:{background:"white",borderBottom:"1px solid #e2e8f0",padding:"16px 24px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(Ie,{size:"small"}),e.jsx(M,{variant:"outline",icon:yt,onClick:()=>t("/staff/dashboard"),children:"Back to Dashboard"})]}),e.jsx("div",{className:"staff-profile-content",style:{maxWidth:"600px",margin:"40px auto",padding:"0 24px"},children:e.jsxs("div",{className:"staff-profile-card",style:{background:"white",borderRadius:"12px",padding:"32px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",marginBottom:"32px",color:"#1e293b"},children:"My Profile"}),e.jsxs("form",{onSubmit:U,children:[e.jsxs("div",{style:{marginBottom:"32px",textAlign:"center"},children:[e.jsx("div",{style:{width:"120px",height:"120px",borderRadius:"50%",margin:"0 auto 16px",border:"3px solid #e2e8f0",background:ge?`url(${ge}) center/cover`:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",fontWeight:"700",fontSize:"36px",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:!ge&&me(d==null?void 0:d.name)}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",justifyContent:"center",alignItems:"center"},children:[e.jsxs("label",{style:{display:"inline-block",padding:"8px 16px",background:"#2563eb",color:"white",borderRadius:"8px",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"background 0.2s"},onMouseOver:c=>{c.target.style.background="#1e40af"},onMouseOut:c=>{c.target.style.background="#2563eb"},children:["Change Picture",e.jsx("input",{type:"file",accept:"image/*",onChange:Q,style:{display:"none"}})]}),ge&&e.jsx(M,{variant:"outline",icon:Ot,onClick:z,disabled:oe,children:oe?"Removing...":"Remove photo"})]}),e.jsx("p",{style:{fontSize:"12px",color:"#64748b",marginTop:"8px"},children:"JPG, PNG, GIF, WebP (max 2MB)"})]}),e.jsx(re,{label:"Name",value:(d==null?void 0:d.name)||"",onChange:c=>C({...d,name:c.target.value}),required:!0}),e.jsx(re,{label:"Username",value:(d==null?void 0:d.username)||"",disabled:!0,readOnly:!0}),e.jsxs("div",{className:"staff-profile-buttons",style:{display:"flex",gap:"12px",marginTop:"24px"},children:[e.jsx(M,{type:"submit",icon:bt,disabled:o,fullWidth:!0,children:o?"Saving...":"Save Changes"}),e.jsx(M,{variant:"outline",icon:xe,onClick:()=>t("/staff/dashboard"),fullWidth:!0,children:"Cancel"})]})]}),e.jsxs("div",{style:{marginTop:"32px",paddingTop:"32px",borderTop:"1px solid #e2e8f0"},children:[e.jsxs("h3",{style:{fontSize:"18px",fontWeight:"600",color:"#1e293b",marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(ot,{size:20}),"Operating window"]}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"12px"},children:y?`You are currently at ${y.label}.`:"You are not assigned to a window yet."}),e.jsxs("form",{onSubmit:m,style:{display:"flex",flexDirection:"row",gap:"12px",alignItems:"center",flexWrap:"wrap",maxWidth:"420px"},children:[e.jsx("div",{style:{flex:"1 1 200px"},children:e.jsxs(tt,{label:"Switch to window",value:R,onChange:c=>E(c.target.value),children:[e.jsx("option",{value:"",children:"â€” Select window â€”"}),D.map(c=>e.jsx("option",{value:c.id,children:c.label},c.id))]})}),e.jsx(M,{type:"submit",icon:ot,disabled:H||!R||R===(y==null?void 0:y.id),fullWidth:!0,style:{flex:"1 1 200px",padding:"12px 20px"},children:H?"Switching...":"Switch window"})]})]}),e.jsxs("div",{style:{marginTop:"32px",paddingTop:"32px",borderTop:"1px solid #e2e8f0"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"#1e293b"},children:"Change Password"}),e.jsx(M,{variant:"outline",icon:lt,onClick:()=>{S(!r),r&&P({currentPassword:"",newPassword:"",confirmPassword:""})},children:r?"Cancel":"Change Password"})]}),r&&e.jsxs("form",{onSubmit:de,children:[e.jsx(re,{label:"Current Password",type:"password",value:T.currentPassword,onChange:c=>P({...T,currentPassword:c.target.value}),required:!0}),e.jsx(re,{label:"New Password",type:"password",value:T.newPassword,onChange:c=>P({...T,newPassword:c.target.value}),required:!0}),e.jsx(re,{label:"Confirm New Password",type:"password",value:T.confirmPassword,onChange:c=>P({...T,confirmPassword:c.target.value}),required:!0}),e.jsx(M,{type:"submit",icon:vt,disabled:f,fullWidth:!0,style:{marginTop:"16px"},children:f?"Changing...":"Change Password"})]})]})]})})]})}function yn(){const t=Ce(),[i,s]=n.useState({username:"",password:""}),[o,a]=n.useState(""),[d,C]=n.useState(!1);n.useEffect(()=>{const p=localStorage.getItem("token"),g=Ae();p&&(g==null?void 0:g.role)==="ADMIN"&&t("/admin/dashboard")},[t]);const h=async p=>{var g,u;p.preventDefault(),a(""),C(!0);try{const r=await j.post("/auth/admin/login",i);localStorage.setItem("token",r.data.token),localStorage.setItem("user",JSON.stringify(r.data.user)),t("/admin/dashboard")}catch(r){a(((u=(g=r.response)==null?void 0:g.data)==null?void 0:u.error)||"Login failed")}finally{C(!1)}};return e.jsxs("div",{className:"admin-login-root",style:{minHeight:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",padding:"20px",paddingLeft:"max(20px, env(safe-area-inset-left))",paddingRight:"max(20px, env(safe-area-inset-right))"},children:[e.jsx("style",{children:`
        @media (max-width: 480px) {
          .admin-login-root { padding: 16px !important; }
          .admin-login-card { padding: 24px !important; }
          .admin-login-title { font-size: 22px !important; }
        }
      `}),e.jsxs("div",{className:"admin-login-card",style:{background:"white",borderRadius:"16px",padding:"40px",maxWidth:"400px",width:"100%",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[e.jsx("div",{style:{marginBottom:"24px",display:"flex",justifyContent:"center"},children:e.jsx(Ie,{size:"medium",titlePosition:"below",align:"center"})}),e.jsx("h1",{className:"admin-login-title",style:{fontSize:"28px",fontWeight:"700",marginBottom:"8px",color:"#1e293b",textAlign:"center"},children:"Admin Login"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",textAlign:"center",marginBottom:"32px"},children:"Sign in to manage the system"}),e.jsxs("form",{onSubmit:h,children:[e.jsx(re,{label:"Username",value:i.username,onChange:p=>s({...i,username:p.target.value}),placeholder:"Enter your username",required:!0,autoFocus:!0}),e.jsx(re,{label:"Password",type:"password",value:i.password,onChange:p=>s({...i,password:p.target.value}),placeholder:"Enter your password",required:!0}),o&&e.jsx("div",{style:{padding:"12px",background:"#fee2e2",color:"#991b1b",borderRadius:"8px",marginBottom:"16px",fontSize:"14px"},children:o}),e.jsx(M,{type:"submit",fullWidth:!0,disabled:d,children:d?"Logging in...":"Login"})]})]})]})}function bn({onProfileClick:t,onLogout:i}){const[s,o]=n.useState(!1),[a,d]=n.useState(null),[C,h]=n.useState(!0),p=n.useRef(null);Ce(),n.useEffect(()=>{g()},[]),n.useEffect(()=>{const r=S=>{p.current&&!p.current.contains(S.target)&&o(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[]);const g=async()=>{try{const r=Ae();r&&d({name:r.name||"Admin",username:r.username})}catch(r){console.error("Failed to load profile:",r)}finally{h(!1)}},u=r=>{if(!r)return"A";const S=r.trim().split(" ");return S.length>=2?(S[0][0]+S[S.length-1][0]).toUpperCase():r.substring(0,2).toUpperCase()};return C?e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:"#e2e8f0"}}):e.jsxs("div",{style:{position:"relative"},ref:p,children:[e.jsx("button",{onClick:()=>o(!s),style:{width:"44px",height:"44px",minWidth:"44px",minHeight:"44px",borderRadius:"50%",border:"2px solid #e2e8f0",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",fontWeight:"700",fontSize:"14px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",padding:0,transition:"all 0.2s"},onMouseOver:r=>{r.target.style.borderColor="#2563eb",r.target.style.transform="scale(1.05)"},onMouseOut:r=>{r.target.style.borderColor="#e2e8f0",r.target.style.transform="scale(1)"},children:u(a==null?void 0:a.name)}),s&&e.jsxs("div",{style:{position:"absolute",top:"48px",right:0,background:"white",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",minWidth:"160px",zIndex:1e3,border:"1px solid #e2e8f0",overflow:"hidden"},children:[e.jsx("div",{style:{padding:"12px 16px",borderBottom:"1px solid #e2e8f0",fontSize:"14px",fontWeight:"600",color:"#1e293b"},children:(a==null?void 0:a.name)||(a==null?void 0:a.username)||"Admin"}),t&&e.jsxs("button",{onClick:()=>{o(!1),t()},style:{width:"100%",padding:"14px 16px",minHeight:"44px",border:"none",background:"transparent",textAlign:"left",fontSize:"14px",color:"#1e293b",cursor:"pointer",transition:"background 0.2s",display:"flex",alignItems:"center",gap:"10px"},onMouseOver:r=>{r.currentTarget.style.background="#f1f5f9"},onMouseOut:r=>{r.currentTarget.style.background="transparent"},children:[e.jsx(ht,{size:18}),"Profile"]}),e.jsxs("button",{onClick:()=>{o(!1),i()},style:{width:"100%",padding:"14px 16px",minHeight:"44px",border:"none",background:"transparent",textAlign:"left",fontSize:"14px",color:"#ef4444",cursor:"pointer",transition:"background 0.2s",display:"flex",alignItems:"center",gap:"10px"},onMouseOver:r=>{r.currentTarget.style.background="#fee2e2"},onMouseOut:r=>{r.currentTarget.style.background="transparent"},children:[e.jsx(mt,{size:18}),"Logout"]})]})]})}function vn({open:t,title:i,message:s,placeholder:o="",onConfirm:a,onCancel:d,confirmText:C="Confirm",cancelText:h="Cancel",type:p="text",required:g=!0}){const[u,r]=n.useState("");if(n.useEffect(()=>{t&&r("")},[t]),!t)return null;const S=()=>{g&&!u.trim()||(a(u),r(""))},T=()=>{r(""),d()};return e.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,animation:"fadeIn 0.2s ease-out"},children:[e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",maxWidth:"400px",width:"90%",boxShadow:"0 10px 25px rgba(0,0,0,0.2)",animation:"slideUp 0.3s ease-out"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"#1e293b",margin:0},children:i}),e.jsx("button",{onClick:T,style:{background:"none",border:"none",cursor:"pointer",padding:"4px",color:"#64748b",display:"flex",alignItems:"center"},children:e.jsx(xe,{size:20})})]}),s&&e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"16px",lineHeight:"1.6"},children:s}),e.jsx("input",{type:p,value:u,onChange:P=>r(P.target.value),placeholder:o,required:g,style:{width:"100%",padding:"10px 12px",border:"2px solid #e2e8f0",borderRadius:"8px",fontSize:"14px",marginBottom:"24px",transition:"border-color 0.2s"},onFocus:P=>{P.target.style.borderColor="#2563eb"},onBlur:P=>{P.target.style.borderColor="#e2e8f0"},onKeyDown:P=>{P.key==="Enter"?S():P.key==="Escape"&&T()},autoFocus:!0}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:T,style:{padding:"10px 20px",border:"2px solid #e2e8f0",borderRadius:"8px",background:"transparent",color:"#64748b",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s"},onMouseOver:P=>{P.target.style.background="#f1f5f9",P.target.style.borderColor="#cbd5e1"},onMouseOut:P=>{P.target.style.background="transparent",P.target.style.borderColor="#e2e8f0"},children:h}),e.jsx("button",{onClick:S,disabled:g&&!u.trim(),style:{padding:"10px 20px",border:"none",borderRadius:"8px",background:g&&!u.trim()?"#cbd5e1":"#2563eb",color:"white",fontSize:"14px",fontWeight:"600",cursor:g&&!u.trim()?"not-allowed":"pointer",transition:"all 0.2s",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},onMouseOver:P=>{g&&!u.trim()||(P.target.style.background="#1e40af",P.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.2)")},onMouseOut:P=>{g&&!u.trim()||(P.target.style.background="#2563eb",P.target.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)")},children:C})]})]}),e.jsx("style",{children:`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes slideUp {
          from {
            transform: translateY(20px);
            opacity: 0;
          }
          to {
            transform: translateY(0);
            opacity: 1;
          }
        }
      `})]})}const ft=["#2563eb","#10b981","#f59e0b","#ef4444","#8b5cf6"];function Ne(t,i){var o;const s=(o=t==null?void 0:t.response)==null?void 0:o.data;if(s!=null&&s.error&&typeof s.error=="string")return s.error;if(Array.isArray(s==null?void 0:s.errors)&&s.errors.length>0){const a=s.errors[0];return(a==null?void 0:a.msg)||(a==null?void 0:a.message)||i}return i}function wn(){const t=Ce(),[i,s]=n.useState("dashboard"),[o,a]=n.useState(!0),[d,C]=n.useState(null),[h,p]=n.useState([]),[g,u]=n.useState([]),[r,S]=n.useState([]),[T,P]=n.useState(null),[f,N]=n.useState({startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],staffIds:[],categoryIds:[],clientTypes:[],startHour:"",endHour:""}),[y,l]=n.useState(!1),[D,A]=n.useState(5),[R,E]=n.useState({open:!1,data:{}}),[H,$]=n.useState({open:!1,data:{}}),[oe,ee]=n.useState({open:!1,data:{}}),[q,ne]=n.useState({open:!1,data:{}}),[m,z]=n.useState({open:!1,title:"",message:"",placeholder:"",type:"text",onConfirm:()=>{},onCancel:()=>{}});n.useEffect(()=>{const w=localStorage.getItem("token"),G=Ae();if(!w||(G==null?void 0:G.role)!=="ADMIN"){t("/admin/login");return}U();const ae=setInterval(()=>{i==="dashboard"&&de()},3e3),fe=setInterval(()=>{i==="staff"&&me()},3e4);return()=>{clearInterval(ae),clearInterval(fe)}},[t,i]),n.useEffect(()=>{i==="reports"&&v()},[i,f]);const Q=async()=>{try{const G=(await j.get("/admin/settings/staff-idle-minutes")).data.staffIdleMinutes;typeof G=="number"&&G>=1&&G<=120&&A(G)}catch(w){console.error("Failed to load staff idle minutes:",w)}},U=async()=>{try{await Promise.all([de(),me(),ge(),c(),Q()])}catch(w){console.error("Error loading data:",w)}finally{a(!1)}},de=async()=>{try{const w=await j.get("/admin/dashboard");C(w.data.stats)}catch(w){console.error("Failed to load dashboard:",w)}},me=async()=>{try{const w=await j.get("/admin/staff");p(w.data.staff)}catch(w){console.error("Failed to load staff:",w)}},ge=async()=>{try{const w=await j.get("/admin/windows");u(w.data.windows)}catch(w){console.error("Failed to load windows:",w)}},c=async()=>{try{const w=await j.get("/categories");S(w.data.categories)}catch(w){console.error("Failed to load categories:",w)}},v=async()=>{try{const w=new URLSearchParams;w.append("startDate",f.startDate),w.append("endDate",f.endDate),f.staffIds&&f.staffIds.length>0&&f.staffIds.forEach(ae=>w.append("staffId",ae)),f.categoryIds&&f.categoryIds.length>0&&f.categoryIds.forEach(ae=>w.append("categoryId",ae)),f.clientTypes&&f.clientTypes.length>0&&f.clientTypes.forEach(ae=>w.append("clientType",ae)),f.startHour&&w.append("startHour",f.startHour),f.endHour&&w.append("endHour",f.endHour);const G=await j.get(`/admin/reports?${w.toString()}`);P(G.data)}catch(w){console.error("Failed to load reports:",w)}},L=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),t("/admin/login")};return o?e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ke,{})}):e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        .admin-dashboard-root {
          padding-left: env(safe-area-inset-left);
          padding-right: env(safe-area-inset-right);
        }
        .admin-dashboard-content {
          padding-left: max(24px, env(safe-area-inset-left));
          padding-right: max(24px, env(safe-area-inset-right));
        }
        @media (max-width: 768px) {
          .admin-dashboard-header {
            flex-wrap: wrap;
            gap: 12px;
            padding: 12px 16px !important;
            padding-left: max(16px, env(safe-area-inset-left)) !important;
            padding-right: max(16px, env(safe-area-inset-right)) !important;
          }
          .admin-dashboard-header > div:first-child {
            flex-direction: row;
            align-items: center;
            gap: 12px;
          }
          .admin-dashboard-header h1 {
            font-size: 20px !important;
          }
          .admin-dashboard-tabs {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            padding: 0 16px !important;
            padding-left: max(16px, env(safe-area-inset-left)) !important;
          }
          .admin-dashboard-tabs button {
            white-space: nowrap;
            font-size: 13px;
            padding: 10px 16px !important;
            min-height: 44px;
            flex-shrink: 0;
          }
          .admin-dashboard-tabs button span {
            display: none;
          }
          .admin-dashboard-content {
            padding: 16px !important;
            padding-left: max(16px, env(safe-area-inset-left)) !important;
            padding-right: max(16px, env(safe-area-inset-right)) !important;
          }
          .admin-stats-grid {
            grid-template-columns: repeat(2, 1fr) !important;
          }
          .admin-stats-grid-4 {
            grid-template-columns: repeat(2, 1fr) !important;
          }
          .admin-cards-grid {
            grid-template-columns: repeat(2, 1fr) !important;
          }
          .admin-reports-grid {
            grid-template-columns: 1fr !important;
          }
          .admin-filter-grid {
            grid-template-columns: 1fr !important;
          }
          .admin-page-header {
            flex-direction: column;
            align-items: flex-start !important;
            gap: 12px;
          }
          .settings-grid {
            grid-template-columns: minmax(0, 1fr) !important;
          }
          .admin-modal-overlay {
            padding: 16px;
            align-items: flex-start;
            overflow-y: auto;
          }
          .admin-modal-box {
            max-height: calc(100vh - 32px);
            overflow-y: auto;
            width: 100%;
            margin: auto;
          }
          .admin-settings-buttons {
            flex-wrap: wrap;
          }
          .admin-settings-buttons button {
            min-width: 140px;
          }
          .admin-reports-table-wrap {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin: 0 -16px;
            padding: 0 16px;
          }
        }
        @media (max-width: 480px) {
          .admin-stats-grid,
          .admin-stats-grid-4,
          .admin-cards-grid {
            grid-template-columns: 1fr !important;
          }
          .admin-dashboard-tabs button {
            padding: 12px 14px !important;
          }
        }
        @media (max-width: 1024px) and (min-width: 769px) {
          .admin-stats-grid-4 {
            grid-template-columns: repeat(2, 1fr) !important;
          }
          .admin-cards-grid {
            grid-template-columns: repeat(3, 1fr) !important;
          }
          .settings-grid {
            grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
            gap: 16px;
          }
        }
      `}),e.jsxs("div",{className:"admin-dashboard-root",style:{minHeight:"100vh",background:"#f8fafc"},children:[e.jsx(vn,{...m}),e.jsxs("div",{className:"admin-dashboard-header",style:{background:"white",borderBottom:"1px solid #e2e8f0",padding:"16px 24px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(Ie,{size:"small"}),e.jsx("div",{style:{flex:1}}),e.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:"#1e293b",margin:0,marginRight:"30px"},children:"Admin Dashboard"}),e.jsx(bn,{onProfileClick:()=>t("/admin/profile"),onLogout:L})]}),e.jsx("div",{className:"admin-dashboard-tabs",style:{background:"white",borderBottom:"1px solid #e2e8f0",padding:"0 24px",display:"flex",gap:"4px"},children:[{id:"dashboard",label:"Dashboard",icon:Mt},{id:"staff",label:"Staff",icon:Ft},{id:"windows",label:"Windows",icon:wt},{id:"categories",label:"Categories",icon:jt},{id:"reports",label:"Reports",icon:Ut},{id:"settings",label:"Settings",icon:Vt}].map(w=>{const G=w.icon,ae=i===w.id;return e.jsxs("button",{onClick:()=>s(w.id),style:{padding:"12px 20px",border:"none",background:ae?"#eff6ff":"transparent",borderBottom:ae?"3px solid #2563eb":"3px solid transparent",color:ae?"#2563eb":"#64748b",fontWeight:ae?"600":"400",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",transition:"all 0.2s",borderRadius:"8px 8px 0 0"},onMouseOver:fe=>{ae||(fe.target.style.background="#f1f5f9",fe.target.style.color="#475569")},onMouseOut:fe=>{ae||(fe.target.style.background="transparent",fe.target.style.color="#64748b")},children:[e.jsx(G,{size:18}),e.jsx("span",{children:w.label})]},w.id)})}),e.jsxs("div",{className:"admin-dashboard-content",style:{maxWidth:"1400px",margin:"0 auto",padding:"24px"},children:[i==="dashboard"&&e.jsx(jn,{stats:d}),i==="staff"&&e.jsx(Sn,{staff:h,categories:r,onRefresh:me,form:R,setForm:E,setInputDialog:z,staffIdleMinutes:D}),i==="windows"&&e.jsx(Cn,{windows:g,onRefresh:ge,form:H,setForm:$}),i==="categories"&&e.jsx(kn,{categories:r,onRefresh:c,categoryForm:oe,setCategoryForm:ee,subCategoryForm:q,setSubCategoryForm:ne}),i==="reports"&&e.jsx(In,{reports:T,filters:f,setFilters:N,staff:h,categories:r,showFilters:y,setShowFilters:l,onRefresh:v}),i==="settings"&&e.jsx(Tn,{staffIdleMinutes:D,onStaffIdleMinutesSaved:A})]})]})]})}function jn({stats:t}){const[i,s]=n.useState(new Date);if(n.useEffect(()=>{const a=setInterval(()=>{s(new Date)},1e3);return()=>clearInterval(a)},[]),!t)return e.jsx(ke,{});const o=a=>{const d=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],C=["January","February","March","April","May","June","July","August","September","October","November","December"],h=d[a.getDay()],p=C[a.getMonth()],g=a.getDate(),u=a.getFullYear();let r=a.getHours();const S=String(a.getMinutes()).padStart(2,"0"),T=String(a.getSeconds()).padStart(2,"0"),P=r>=12?"PM":"AM";return r=r%12,r=r||12,`${h}, ${p} ${g}, ${u} at ${r}:${S}:${T} ${P}`};return e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:"24px"},children:e.jsx("div",{style:{fontSize:"18px",fontWeight:"600",color:"#1e293b"},children:o(i)})}),e.jsxs("div",{className:"admin-stats-grid-4",style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"16px",marginBottom:"16px"},children:[e.jsx(Se,{label:"Queue Entries Today",value:t.todayQueueEntries,icon:Ht,color:"#2563eb"}),e.jsx(Se,{label:"Serving",value:t.servingCount,icon:qt,color:"#2563eb"}),e.jsx(Se,{label:"Waiting",value:t.waitingCount,icon:$t,color:"#f59e0b"}),e.jsx(Se,{label:"Served Today",value:t.todayServed,icon:rt,color:"#10b981"})]}),e.jsxs("div",{className:"admin-stats-grid-4",style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"16px",marginBottom:"24px"},children:[e.jsx(Se,{label:"Active Windows",value:t.activeWindows,icon:ot,color:"#10b981"}),e.jsx(Se,{label:"Active Staff",value:t.activeStaff,icon:Yt,color:"#10b981"}),e.jsx(Se,{label:"Total Windows",value:t.totalWindows,icon:_t,color:"#2563eb"}),e.jsx(Se,{label:"Total Staff",value:t.totalStaff,icon:Gt,color:"#2563eb"})]})]})}function Se({label:t,value:i,color:s="#2563eb",icon:o}){return e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[o&&e.jsx(o,{size:20,color:s,style:{flexShrink:0}}),e.jsx("div",{style:{fontSize:"14px",color:"#64748b",fontWeight:"500"},children:t})]}),e.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:s,lineHeight:"1.2"},children:i||0})]})}function Sn({staff:t,categories:i,onRefresh:s,form:o,setForm:a,setInputDialog:d,staffIdleMinutes:C=5}){const[h,p]=n.useState(null),[g,u]=n.useState(!1),r=n.useRef(null),[S,T]=n.useState({open:!1});n.useEffect(()=>{const l=D=>{r.current&&!r.current.contains(D.target)&&u(!1)};return g&&document.addEventListener("mousedown",l),()=>{document.removeEventListener("mousedown",l)}},[g]);const P=async l=>{l.preventDefault();try{await j.post("/admin/staff",o.data),a({open:!1,data:{}}),J("Staff created successfully!"),s()}catch(D){F(Ne(D,"Failed to create staff"))}},f=async l=>{l.preventDefault();try{await j.put(`/admin/staff/${h.id}`,o.data),a({open:!1,data:{}}),p(null),J("Staff updated successfully!"),s()}catch(D){F(Ne(D,"Failed to update staff"))}},N=async(l,D)=>{try{await j.put(`/admin/staff/${l}`,{isActive:!D}),J(`Staff ${D?"deactivated":"activated"} successfully!`),s()}catch(A){F(Ne(A,"Failed to update staff"))}},y=async(l,D)=>{d({open:!0,title:"Reset Password",message:`Enter new password for ${D}:`,placeholder:"New password (min 6 characters)",type:"password",onConfirm:async A=>{var R,E;if(d({open:!1}),!!A){if(A.length<6){F("Password must be at least 6 characters");return}try{await j.post(`/admin/staff/${l}/reset-password`,{password:A}),J("Password reset successfully!")}catch(H){F(((E=(R=H.response)==null?void 0:R.data)==null?void 0:E.error)||"Failed to reset password")}}},onCancel:()=>d({open:!1})})};return e.jsxs("div",{children:[e.jsx(Le,{...S}),e.jsxs("div",{className:"admin-page-header",style:{display:"flex",justifyContent:"space-between",marginBottom:"24px"},children:[e.jsx("h2",{style:{fontSize:"20px",fontWeight:"600"},children:"Staff Management"}),e.jsx(M,{onClick:()=>{a({open:!0,data:{}}),p(null)},children:"Add Staff"})]}),o.open&&He.createPortal(e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:()=>{a({open:!1,data:{}}),p(null)},className:"admin-modal-overlay",children:e.jsxs("div",{className:"admin-modal-box",style:{background:"white",borderRadius:"12px",padding:"24px",maxWidth:"500px",width:"90%",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 10px 25px rgba(0,0,0,0.2)"},onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h3",{style:{fontSize:"20px",fontWeight:"600",margin:0},children:h?"Edit Staff":"Create Staff"}),e.jsx("button",{onClick:()=>{a({open:!1,data:{}}),p(null)},style:{background:"none",border:"none",cursor:"pointer",padding:"4px",color:"#64748b",display:"flex",alignItems:"center"},children:e.jsx(xe,{size:20})})]}),e.jsxs("form",{onSubmit:h?f:P,children:[e.jsx(re,{label:"Username",value:o.data.username||"",onChange:l=>a({...o,data:{...o.data,username:l.target.value}}),required:!h,disabled:!!h}),e.jsx(re,{label:"Name",value:o.data.name||"",onChange:l=>a({...o,data:{...o.data,name:l.target.value}}),required:!0}),(!h||o.data.password)&&e.jsx(re,{label:"Password",type:"password",value:o.data.password||"",onChange:l=>a({...o,data:{...o.data,password:l.target.value}}),required:!h}),e.jsxs("div",{style:{marginBottom:"16px",position:"relative"},ref:r,children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500",color:"#1e293b"},children:"Specializations (Categories)"}),e.jsx("div",{onClick:()=>u(!g),style:{width:"100%",padding:"12px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px",backgroundColor:"white",cursor:"pointer",minHeight:"44px",display:"flex",alignItems:"center",flexWrap:"wrap",gap:"6px"},children:o.data.categoryIds&&o.data.categoryIds.length>0?o.data.categoryIds.map(l=>{const D=i.find(A=>A.id===l);return D?e.jsxs("span",{style:{fontSize:"12px",padding:"4px 8px",borderRadius:"6px",background:"#eff6ff",color:"#2563eb",fontWeight:"500",display:"flex",alignItems:"center",gap:"4px"},onClick:A=>{A.stopPropagation(),a({...o,data:{...o.data,categoryIds:o.data.categoryIds.filter(R=>R!==l)}})},children:[D.name,e.jsx(xe,{size:12})]},l):null}):e.jsx("span",{style:{color:"#94a3b8"},children:"Select categories..."})}),g&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"white",border:"2px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",zIndex:1e3,maxHeight:"200px",overflowY:"auto"},children:i.map(l=>{var A;const D=((A=o.data.categoryIds)==null?void 0:A.includes(l.id))||!1;return e.jsxs("div",{onClick:()=>{const R=o.data.categoryIds||[];a(D?{...o,data:{...o.data,categoryIds:R.filter(E=>E!==l.id)}}:{...o,data:{...o.data,categoryIds:[...R,l.id]}})},style:{padding:"10px 12px",cursor:"pointer",background:D?"#eff6ff":"white",color:D?"#2563eb":"#1e293b",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid #f1f5f9"},onMouseOver:R=>{D||(R.currentTarget.style.background="#f8fafc")},onMouseOut:R=>{D||(R.currentTarget.style.background="white")},children:[e.jsx("input",{type:"checkbox",checked:D,onChange:()=>{},style:{cursor:"pointer"}}),e.jsx("span",{children:l.name})]},l.id)})})]}),e.jsxs("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:[e.jsx(M,{variant:"outline",icon:xe,onClick:()=>{a({open:!1,data:{}}),p(null)},children:"Cancel"}),e.jsx(M,{type:"submit",icon:qe,children:h?"Update":"Create"})]})]})]})}),document.body),e.jsx("div",{className:"admin-cards-grid",style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"16px"},children:t.map(l=>{const D=l.name?l.name.split(" ").map(E=>E[0]).join("").toUpperCase().slice(0,2):l.username.charAt(0).toUpperCase(),A=l.specializations?l.specializations.map(E=>E.category.name):[],R=l.profilePicture?l.profilePicture.startsWith("http")||l.profilePicture.startsWith("/")?l.profilePicture:"/"+l.profilePicture:null;return e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"16px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",display:"flex",flexDirection:"column",gap:"12px",alignItems:"center"},children:[e.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:R?"transparent":"#2563eb",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",marginBottom:"8px",border:R?"2px solid #e2e8f0":"none"},children:R?e.jsx("img",{src:R,alt:l.name,style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx("span",{style:{color:"white",fontSize:"28px",fontWeight:"600"},children:D})}),e.jsxs("div",{style:{textAlign:"center",marginBottom:"8px"},children:[e.jsx("div",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"2px"},children:l.name}),e.jsx("div",{style:{fontSize:"12px",color:"#64748b"},children:l.username})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",marginBottom:"8px",fontSize:"12px",color:"#64748b"},children:[e.jsx("span",{style:{width:"8px",height:"8px",borderRadius:"50%",background:(()=>{const E=l.lastSeenAt?new Date(l.lastSeenAt).getTime():0,H=(C||5)*60*1e3,$=Date.now()-H;return E>=$?"#22c55e":"#94a3b8"})(),flexShrink:0}}),e.jsx("span",{children:(()=>{const E=l.lastSeenAt?new Date(l.lastSeenAt).getTime():0,H=(C||5)*60*1e3,$=Date.now()-H;return E>=$?"Online":"Offline"})()})]}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px",justifyContent:"center",marginBottom:"8px"},children:A.length>0?A.map((E,H)=>e.jsx("span",{style:{fontSize:"11px",padding:"4px 8px",borderRadius:"12px",background:"#eff6ff",color:"#2563eb",fontWeight:"500"},children:E},H)):e.jsx("span",{style:{fontSize:"11px",padding:"4px 8px",borderRadius:"12px",background:"#f1f5f9",color:"#64748b",fontWeight:"500"},children:"All categories"})}),e.jsx("div",{style:{marginBottom:"8px"},children:e.jsx("span",{style:{fontSize:"11px",padding:"4px 12px",borderRadius:"12px",background:l.isActive?"#ecfdf5":"#fef2f2",color:l.isActive?"#059669":"#dc2626",fontWeight:"600"},children:l.isActive?"Active":"Inactive"})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginTop:"auto",width:"100%"},children:[e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsxs("button",{onClick:()=>{p(l),a({open:!0,data:{username:l.username,name:l.name,categoryIds:l.specializations?l.specializations.map(E=>E.categoryId):[]}})},style:{fontSize:"12px",padding:"6px 12px",border:"none",background:"transparent",color:"#2563eb",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",fontWeight:"500",borderRadius:"6px",transition:"all 0.2s",width:"25%"},onMouseOver:E=>{E.target.style.background="#eff6ff"},onMouseOut:E=>{E.target.style.background="transparent"},children:[e.jsx(dt,{size:14}),"Edit"]}),e.jsxs("button",{onClick:()=>y(l.id,l.name),style:{fontSize:"12px",padding:"6px 12px",border:"none",background:"transparent",color:"#2563eb",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",fontWeight:"500",borderRadius:"6px",transition:"all 0.2s",width:"75%"},onMouseOver:E=>{E.target.style.background="#eff6ff"},onMouseOut:E=>{E.target.style.background="transparent"},children:[e.jsx(lt,{size:14}),"Reset Password"]})]}),e.jsxs("div",{style:{display:"flex",gap:"8px",width:"100%"},children:[e.jsx(M,{variant:l.isActive?"danger":"success",icon:Qt,onClick:()=>N(l.id,l.isActive),style:{fontSize:"12px",padding:"6px 12px",flex:1},children:l.isActive?"Deactivate":"Activate"}),e.jsx(M,{variant:"danger",icon:Xe,onClick:()=>{T({open:!0,title:"Remove Staff",message:`Are you sure you want to remove ${l.name||l.username}? This cannot be undone and is only allowed if the staff has no serving history.`,onConfirm:async()=>{T({open:!1});try{await j.delete(`/admin/staff/${l.id}`),J("Staff removed successfully!"),s()}catch(E){F(Ne(E,"Failed to remove staff"))}},onCancel:()=>T({open:!1})})},style:{fontSize:"12px",padding:"6px 12px",flex:1},children:"Remove"})]})]})]},l.id)})})]})}function Cn({windows:t,onRefresh:i,form:s,setForm:o}){const[a,d]=n.useState(null),[C,h]=n.useState({open:!1}),p=async r=>{r.preventDefault();try{await j.post("/admin/windows",s.data),o({open:!1,data:{}}),J("Window created successfully!"),i()}catch(S){F(Ne(S,"Failed to create window"))}},g=async r=>{r.preventDefault();try{await j.put(`/admin/windows/${a.id}`,s.data),o({open:!1,data:{}}),d(null),J("Window updated successfully!"),i()}catch(S){F(Ne(S,"Failed to update window"))}},u=async r=>{h({open:!0,title:"Delete Window",message:"Are you sure you want to delete this window? This action cannot be undone.",onConfirm:async()=>{h({open:!1});try{await j.delete(`/admin/windows/${r}`),J("Window deleted successfully!"),i()}catch(S){F(Ne(S,"Failed to delete window"))}},onCancel:()=>h({open:!1})})};return e.jsxs("div",{children:[e.jsx(Le,{...C}),e.jsxs("div",{className:"admin-page-header",style:{display:"flex",justifyContent:"space-between",marginBottom:"24px"},children:[e.jsx("h2",{style:{fontSize:"20px",fontWeight:"600"},children:"Window Management"}),e.jsx(M,{icon:at,onClick:()=>{o({open:!0,data:{isActive:!0}}),d(null)},children:"Add Window"})]}),s.open&&He.createPortal(e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:()=>{o({open:!1,data:{}}),d(null)},className:"admin-modal-overlay",children:e.jsxs("div",{className:"admin-modal-box",style:{background:"white",borderRadius:"12px",padding:"24px",maxWidth:"500px",width:"90%",boxShadow:"0 10px 25px rgba(0,0,0,0.2)"},onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h3",{style:{fontSize:"20px",fontWeight:"600",margin:0},children:a?"Edit Window":"Create Window"}),e.jsx("button",{onClick:()=>{o({open:!1,data:{}}),d(null)},style:{background:"none",border:"none",cursor:"pointer",padding:"4px",color:"#64748b",display:"flex",alignItems:"center"},children:e.jsx(xe,{size:20})})]}),e.jsxs("form",{onSubmit:a?g:p,children:[e.jsx(re,{label:"Window Label",value:s.data.label||"",onChange:r=>o({...s,data:{...s.data,label:r.target.value}}),required:!0}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"16px"},children:[e.jsx("input",{type:"checkbox",checked:s.data.isActive!==!1,onChange:r=>o({...s,data:{...s.data,isActive:r.target.checked}})}),"Active"]}),e.jsxs("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:[e.jsx(M,{variant:"outline",icon:xe,onClick:()=>{o({open:!1,data:{}}),d(null)},children:"Cancel"}),e.jsx(M,{type:"submit",icon:qe,children:a?"Update":"Create"})]})]})]})}),document.body),e.jsx("div",{className:"admin-cards-grid",style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"16px"},children:t.map(r=>e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"16px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",display:"flex",flexDirection:"column",gap:"12px",alignItems:"center"},children:[e.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:"#2563eb",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:"8px"},children:e.jsx(wt,{size:40,color:"white"})}),e.jsx("div",{style:{textAlign:"center",marginBottom:"8px"},children:e.jsx("div",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"2px"},children:r.label})}),r.assignments&&r.assignments.length>0&&e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px",justifyContent:"center",marginBottom:"8px"},children:r.assignments.map(S=>e.jsx("span",{style:{fontSize:"11px",padding:"4px 8px",borderRadius:"12px",background:"#eff6ff",color:"#2563eb",fontWeight:"500"},children:S.staff.name},S.id))}),e.jsx("div",{style:{marginBottom:"8px"},children:e.jsx("span",{style:{fontSize:"11px",padding:"4px 12px",borderRadius:"12px",background:r.isActive?"#ecfdf5":"#fef2f2",color:r.isActive?"#059669":"#dc2626",fontWeight:"600"},children:r.isActive?"Active":"Inactive"})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginTop:"auto",width:"100%"},children:e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsxs("button",{onClick:()=>{d(r),o({open:!0,data:{label:r.label,isActive:r.isActive}})},style:{fontSize:"12px",padding:"6px 12px",border:"none",background:"transparent",color:"#2563eb",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",fontWeight:"500",borderRadius:"6px",transition:"all 0.2s",width:"50%"},onMouseOver:S=>{S.target.style.background="#eff6ff"},onMouseOut:S=>{S.target.style.background="transparent"},children:[e.jsx(dt,{size:14}),"Edit"]}),e.jsx(M,{variant:"danger",icon:Xe,onClick:()=>u(r.id),style:{fontSize:"12px",padding:"6px 12px",width:"50%"},children:"Delete"})]})})]},r.id))})]})}function kn({categories:t,onRefresh:i,categoryForm:s,setCategoryForm:o,subCategoryForm:a,setSubCategoryForm:d}){const[C,h]=n.useState(null),[p,g]=n.useState({open:!1}),u=async f=>{var N,y;f.preventDefault();try{await j.post("/admin/categories",s.data),o({open:!1,data:{}}),J("Category created successfully!"),i()}catch(l){F(((y=(N=l.response)==null?void 0:N.data)==null?void 0:y.error)||"Failed to create category")}},r=async f=>{var N,y;f.preventDefault();try{await j.put(`/admin/categories/${C.id}`,s.data),o({open:!1,data:{}}),h(null),J("Category updated successfully!"),i()}catch(l){F(((y=(N=l.response)==null?void 0:N.data)==null?void 0:y.error)||"Failed to update category")}},S=async f=>{g({open:!0,title:"Delete Category",message:"Are you sure you want to delete this category? All subcategories will be deleted. This action cannot be undone.",onConfirm:async()=>{var N,y;g({open:!1});try{await j.delete(`/admin/categories/${f}`),J("Category deleted successfully!"),i()}catch(l){F(((y=(N=l.response)==null?void 0:N.data)==null?void 0:y.error)||"Failed to delete category")}},onCancel:()=>g({open:!1})})},T=async f=>{var N,y;f.preventDefault();try{await j.post(`/admin/categories/${a.data.categoryId}/subcategories`,{name:a.data.name,description:a.data.description}),d({open:!1,data:{}}),J("Subcategory created successfully!"),i()}catch(l){F(((y=(N=l.response)==null?void 0:N.data)==null?void 0:y.error)||"Failed to create subcategory")}},P=async f=>{g({open:!0,title:"Delete Subcategory",message:"Are you sure you want to delete this subcategory? This action cannot be undone.",onConfirm:async()=>{var N,y;g({open:!1});try{await j.delete(`/admin/subcategories/${f}`),J("Subcategory deleted successfully!"),i()}catch(l){F(((y=(N=l.response)==null?void 0:N.data)==null?void 0:y.error)||"Failed to delete subcategory")}},onCancel:()=>g({open:!1})})};return e.jsxs("div",{children:[e.jsx(Le,{...p}),e.jsxs("div",{className:"admin-page-header",style:{display:"flex",justifyContent:"space-between",marginBottom:"24px"},children:[e.jsx("h2",{style:{fontSize:"20px",fontWeight:"600"},children:"Category Management"}),e.jsx(M,{icon:at,onClick:()=>{o({open:!0,data:{}}),h(null)},children:"Add Category"})]}),s.open&&He.createPortal(e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:()=>{o({open:!1,data:{}}),h(null)},className:"admin-modal-overlay",children:e.jsxs("div",{className:"admin-modal-box",style:{background:"white",borderRadius:"12px",padding:"24px",maxWidth:"500px",width:"90%",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 10px 25px rgba(0,0,0,0.2)"},onClick:f=>f.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h3",{style:{fontSize:"20px",fontWeight:"600",margin:0},children:C?"Edit Category":"Create Category"}),e.jsx("button",{onClick:()=>{o({open:!1,data:{}}),h(null)},style:{background:"none",border:"none",cursor:"pointer",padding:"4px",color:"#64748b",display:"flex",alignItems:"center"},children:e.jsx(xe,{size:20})})]}),e.jsxs("form",{onSubmit:C?r:u,children:[e.jsx(re,{label:"Category Name",value:s.data.name||"",onChange:f=>o({...s,data:{...s.data,name:f.target.value}}),required:!0}),e.jsx(re,{label:"Description (Optional)",value:s.data.description||"",onChange:f=>o({...s,data:{...s.data,description:f.target.value}})}),e.jsxs("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:[e.jsx(M,{variant:"outline",icon:xe,onClick:()=>{o({open:!1,data:{}}),h(null)},children:"Cancel"}),e.jsx(M,{type:"submit",icon:qe,children:C?"Update":"Create"})]})]})]})}),document.body),a.open&&He.createPortal(e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:()=>{d({open:!1,data:{}})},className:"admin-modal-overlay",children:e.jsxs("div",{className:"admin-modal-box",style:{background:"white",borderRadius:"12px",padding:"24px",maxWidth:"500px",width:"90%",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 10px 25px rgba(0,0,0,0.2)"},onClick:f=>f.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h3",{style:{fontSize:"20px",fontWeight:"600",margin:0},children:"Add Subcategory"}),e.jsx("button",{onClick:()=>{d({open:!1,data:{}})},style:{background:"none",border:"none",cursor:"pointer",padding:"4px",color:"#64748b",display:"flex",alignItems:"center"},children:e.jsx(xe,{size:20})})]}),e.jsxs("form",{onSubmit:T,children:[e.jsx(re,{label:"Subcategory Name",value:a.data.name||"",onChange:f=>d({...a,data:{...a.data,name:f.target.value}}),required:!0}),e.jsx(re,{label:"Description (Optional)",value:a.data.description||"",onChange:f=>d({...a,data:{...a.data,description:f.target.value}})}),e.jsxs("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:[e.jsx(M,{variant:"outline",icon:xe,onClick:()=>{d({open:!1,data:{}})},children:"Cancel"}),e.jsx(M,{type:"submit",icon:qe,children:"Create"})]})]})]})}),document.body),e.jsx("div",{className:"admin-cards-grid",style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"16px"},children:t.map(f=>e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"16px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",display:"flex",flexDirection:"column",gap:"12px",alignItems:"center"},children:[e.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:"#10b981",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:"8px"},children:e.jsx(jt,{size:40,color:"white"})}),e.jsxs("div",{style:{textAlign:"center",marginBottom:"8px"},children:[e.jsx("div",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"2px"},children:f.name}),f.description&&e.jsx("div",{style:{fontSize:"12px",color:"#64748b",lineHeight:"1.4"},children:f.description})]}),f.subCategories&&f.subCategories.length>0&&e.jsx("div",{style:{marginBottom:"8px"},children:e.jsxs("span",{style:{fontSize:"11px",padding:"4px 12px",borderRadius:"12px",background:"#eff6ff",color:"#2563eb",fontWeight:"600"},children:[f.subCategories.length," Subcategor",f.subCategories.length===1?"y":"ies"]})}),f.subCategories&&f.subCategories.length>0&&e.jsx("div",{style:{width:"100%",marginBottom:"8px",maxHeight:"120px",overflowY:"auto",padding:"8px",background:"#f8fafc",borderRadius:"8px"},children:f.subCategories.map(N=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 8px",marginBottom:"4px",background:"white",borderRadius:"6px",fontSize:"12px"},children:[e.jsx("span",{style:{fontWeight:"500",color:"#1e293b"},children:N.name}),e.jsx("button",{onClick:()=>P(N.id),style:{background:"none",border:"none",color:"#ef4444",cursor:"pointer",padding:"2px 6px",fontSize:"12px",borderRadius:"4px"},onMouseOver:y=>{y.target.style.background="#fee2e2"},onMouseOut:y=>{y.target.style.background="transparent"},children:e.jsx(Xe,{size:12})})]},N.id))}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginTop:"auto",width:"100%"},children:[e.jsx(M,{variant:"outline",icon:at,onClick:()=>{d({open:!0,data:{categoryId:f.id,name:"",description:""}})},style:{fontSize:"12px",padding:"6px 12px",width:"100%"},children:"Add Subcategory"}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsxs("button",{onClick:()=>{h(f),o({open:!0,data:{name:f.name,description:f.description||""}})},style:{fontSize:"12px",padding:"6px 12px",border:"none",background:"transparent",color:"#2563eb",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",fontWeight:"500",borderRadius:"6px",transition:"all 0.2s",width:"50%"},onMouseOver:N=>{N.target.style.background="#eff6ff"},onMouseOut:N=>{N.target.style.background="transparent"},children:[e.jsx(dt,{size:14}),"Edit"]}),e.jsx(M,{variant:"danger",icon:Xe,onClick:()=>S(f.id),style:{fontSize:"12px",padding:"6px 12px",width:"50%"},children:"Delete"})]})]})]},f.id))})]})}function In({reports:t,filters:i,setFilters:s,staff:o,categories:a,showFilters:d,setShowFilters:C,onRefresh:h}){const[p,g]=n.useState(i),[u,r]=n.useState(!1),[S,T]=n.useState(!1),[P,f]=n.useState(!1),N=n.useRef(null),y=n.useRef(null),l=n.useRef(null);n.useEffect(()=>{d&&g(i)},[d]),n.useEffect(()=>{const m=z=>{N.current&&!N.current.contains(z.target)&&r(!1),y.current&&!y.current.contains(z.target)&&T(!1),l.current&&!l.current.contains(z.target)&&f(!1)};return(u||S||P)&&document.addEventListener("mousedown",m),()=>{document.removeEventListener("mousedown",m)}},[u,S,P]);const D=["REGULAR","SENIOR_CITIZEN","PWD","PREGNANT"],A=Array.from({length:24},(m,z)=>z),R=()=>{const m=new Date().toISOString().split("T")[0],z={startDate:m,endDate:m,staffIds:[],categoryIds:[],clientTypes:[],startHour:"",endHour:""};s(z),g(z)},E=()=>{s(p),C(!1)},H=()=>{g(i),C(!1)},$=i.staffIds.length>0||i.categoryIds.length>0||i.clientTypes.length>0||i.startHour||i.endHour;if(!t)return e.jsx(ke,{});const oe=t.byCategory?Object.entries(t.byCategory).map(([m,z])=>({name:m,value:z})):[],ee=t.byClientType?Object.entries(t.byClientType).map(([m,z])=>({name:m,value:z})):[],q=t.byStaff?Object.entries(t.byStaff).map(([m,z])=>({name:m,value:z})):[],ne=t.byHour?Object.entries(t.byHour).sort((m,z)=>parseInt(m[0])-parseInt(z[0])).map(([m,z])=>({hour:`${m}:00`,value:z})):[];return e.jsxs("div",{children:[e.jsxs("div",{className:"admin-page-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"},children:[e.jsx("h2",{style:{fontSize:"20px",fontWeight:"600"},children:"Reports & Analytics"}),e.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center"},children:[$&&e.jsxs("button",{onClick:R,style:{fontSize:"14px",padding:"8px 16px",border:"none",background:"transparent",boxShadow:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",color:"#64748b",fontWeight:"500"},onMouseOver:m=>{m.target.style.color="#1e293b"},onMouseOut:m=>{m.target.style.color="#64748b"},children:[e.jsx(xe,{size:16}),"Clear Filters"]}),e.jsxs("button",{onClick:()=>C(!0),style:{fontSize:"14px",padding:"8px 16px",border:"none",background:"transparent",boxShadow:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",color:$?"#2563eb":"#64748b",fontWeight:"500"},onMouseOver:m=>{m.target.style.color="#2563eb"},onMouseOut:m=>{m.target.style.color=$?"#2563eb":"#64748b"},children:[e.jsx(Kt,{size:16}),"Filters"]})]})]}),d&&He.createPortal(e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:H,className:"admin-modal-overlay",children:e.jsxs("div",{className:"admin-modal-box",style:{background:"white",borderRadius:"12px",padding:"24px",maxWidth:"800px",width:"90%",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 10px 25px rgba(0,0,0,0.2)"},onClick:m=>m.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h3",{style:{fontSize:"20px",fontWeight:"600",margin:0},children:"Filter Reports"}),e.jsx("button",{onClick:H,style:{background:"none",border:"none",cursor:"pointer",padding:"4px",color:"#64748b",display:"flex",alignItems:"center"},children:e.jsx(xe,{size:20})})]}),e.jsxs("div",{className:"admin-filter-grid",style:{display:"flex",flexDirection:"column",gap:"20px"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 2fr",gap:"20px",alignItems:"end"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500"},children:"Start Date"}),e.jsx("input",{type:"date",value:p.startDate,onChange:m=>g({...p,startDate:m.target.value}),style:{width:"100%",padding:"10px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500"},children:"End Date"}),e.jsx("input",{type:"date",value:p.endDate,onChange:m=>g({...p,endDate:m.target.value}),style:{width:"100%",padding:"10px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px"}})]}),e.jsxs("div",{style:{position:"relative"},ref:N,children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500"},children:"Staff"}),e.jsx("div",{onClick:()=>r(!u),style:{width:"100%",padding:"10px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px",backgroundColor:"white",cursor:"pointer",minHeight:"44px",display:"flex",alignItems:"center",flexWrap:"wrap",gap:"6px"},children:p.staffIds&&p.staffIds.length>0?p.staffIds.map(m=>{const z=o.find(Q=>Q.id===m);return z?e.jsxs("span",{style:{fontSize:"12px",padding:"4px 8px",borderRadius:"6px",background:"#eff6ff",color:"#2563eb",fontWeight:"500",display:"flex",alignItems:"center",gap:"4px"},onClick:Q=>{Q.stopPropagation(),g({...p,staffIds:p.staffIds.filter(U=>U!==m)})},children:[z.name,e.jsx(xe,{size:12})]},m):null}):e.jsx("span",{style:{color:"#94a3b8"},children:"Select staff..."})}),u&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"white",border:"2px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",zIndex:1e3,maxHeight:"200px",overflowY:"auto"},children:o.map(m=>{var Q;const z=((Q=p.staffIds)==null?void 0:Q.includes(m.id))||!1;return e.jsxs("div",{onClick:()=>{const U=p.staffIds||[];g(z?{...p,staffIds:U.filter(de=>de!==m.id)}:{...p,staffIds:[...U,m.id]})},style:{padding:"10px 12px",cursor:"pointer",background:z?"#eff6ff":"white",color:z?"#2563eb":"#1e293b",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid #f1f5f9"},onMouseOver:U=>{z||(U.currentTarget.style.background="#f8fafc")},onMouseOut:U=>{z||(U.currentTarget.style.background="white")},children:[e.jsx("input",{type:"checkbox",checked:z,onChange:()=>{},style:{cursor:"pointer"}}),e.jsx("span",{children:m.name})]},m.id)})})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px",alignItems:"end"},children:[e.jsxs("div",{style:{position:"relative"},ref:y,children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500"},children:"Categories"}),e.jsx("div",{onClick:()=>T(!S),style:{width:"100%",padding:"10px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px",backgroundColor:"white",cursor:"pointer",minHeight:"44px",display:"flex",alignItems:"center",flexWrap:"wrap",gap:"6px"},children:p.categoryIds&&p.categoryIds.length>0?p.categoryIds.map(m=>{const z=a.find(Q=>Q.id===m);return z?e.jsxs("span",{style:{fontSize:"12px",padding:"4px 8px",borderRadius:"6px",background:"#eff6ff",color:"#2563eb",fontWeight:"500",display:"flex",alignItems:"center",gap:"4px"},onClick:Q=>{Q.stopPropagation(),g({...p,categoryIds:p.categoryIds.filter(U=>U!==m)})},children:[z.name,e.jsx(xe,{size:12})]},m):null}):e.jsx("span",{style:{color:"#94a3b8"},children:"Select categories..."})}),S&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"white",border:"2px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",zIndex:1e3,maxHeight:"200px",overflowY:"auto"},children:a.map(m=>{var Q;const z=((Q=p.categoryIds)==null?void 0:Q.includes(m.id))||!1;return e.jsxs("div",{onClick:()=>{const U=p.categoryIds||[];g(z?{...p,categoryIds:U.filter(de=>de!==m.id)}:{...p,categoryIds:[...U,m.id]})},style:{padding:"10px 12px",cursor:"pointer",background:z?"#eff6ff":"white",color:z?"#2563eb":"#1e293b",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid #f1f5f9"},onMouseOver:U=>{z||(U.currentTarget.style.background="#f8fafc")},onMouseOut:U=>{z||(U.currentTarget.style.background="white")},children:[e.jsx("input",{type:"checkbox",checked:z,onChange:()=>{},style:{cursor:"pointer"}}),e.jsx("span",{children:m.name})]},m.id)})})]}),e.jsxs("div",{style:{position:"relative"},ref:l,children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500"},children:"Client Types"}),e.jsx("div",{onClick:()=>f(!P),style:{width:"100%",padding:"10px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px",backgroundColor:"white",cursor:"pointer",minHeight:"44px",display:"flex",alignItems:"center",flexWrap:"wrap",gap:"6px"},children:p.clientTypes&&p.clientTypes.length>0?p.clientTypes.map(m=>e.jsxs("span",{style:{fontSize:"12px",padding:"4px 8px",borderRadius:"6px",background:"#eff6ff",color:"#2563eb",fontWeight:"500",display:"flex",alignItems:"center",gap:"4px"},onClick:z=>{z.stopPropagation(),g({...p,clientTypes:p.clientTypes.filter(Q=>Q!==m)})},children:[m.replace("_"," "),e.jsx(xe,{size:12})]},m)):e.jsx("span",{style:{color:"#94a3b8"},children:"Select client types..."})}),P&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"white",border:"2px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",zIndex:1e3,maxHeight:"200px",overflowY:"auto"},children:D.map(m=>{var Q;const z=((Q=p.clientTypes)==null?void 0:Q.includes(m))||!1;return e.jsxs("div",{onClick:()=>{const U=p.clientTypes||[];g(z?{...p,clientTypes:U.filter(de=>de!==m)}:{...p,clientTypes:[...U,m]})},style:{padding:"10px 12px",cursor:"pointer",background:z?"#eff6ff":"white",color:z?"#2563eb":"#1e293b",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid #f1f5f9"},onMouseOver:U=>{z||(U.currentTarget.style.background="#f8fafc")},onMouseOut:U=>{z||(U.currentTarget.style.background="white")},children:[e.jsx("input",{type:"checkbox",checked:z,onChange:()=>{},style:{cursor:"pointer"}}),e.jsx("span",{children:m.replace("_"," ")})]},m)})})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px",alignItems:"end"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500"},children:"Start Hour (Peak Hours)"}),e.jsxs(tt,{value:p.startHour,onChange:m=>g({...p,startHour:m.target.value}),children:[e.jsx("option",{value:"",children:"All Hours"}),A.map(m=>e.jsxs("option",{value:m,children:[String(m).padStart(2,"0"),":00"]},m))]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500"},children:"End Hour (Peak Hours)"}),e.jsxs(tt,{value:p.endHour,onChange:m=>g({...p,endHour:m.target.value}),children:[e.jsx("option",{value:"",children:"All Hours"}),A.map(m=>e.jsxs("option",{value:m,children:[String(m).padStart(2,"0"),":00"]},m))]})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end",marginTop:"24px",paddingTop:"24px",borderTop:"1px solid #e2e8f0"},children:[e.jsx(M,{variant:"outline",icon:xe,onClick:H,children:"Cancel"}),e.jsx(M,{variant:"primary",icon:qe,onClick:E,children:"Apply Filters"})]})]})}),document.body),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"16px",marginBottom:"24px"},children:[e.jsx(Se,{label:"Total Served",value:t.totalServed}),e.jsx(Se,{label:"Average Duration",value:`${Math.floor((t.averageDuration||0)/60)}m ${(t.averageDuration||0)%60}s`})]}),e.jsxs("div",{className:"admin-reports-grid",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"24px",marginBottom:"24px"},children:[oe.length>0&&e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("h3",{style:{marginBottom:"16px"},children:"By Category"}),e.jsx(Oe,{width:"100%",height:300,children:e.jsxs(it,{data:oe,children:[e.jsx(Qe,{strokeDasharray:"3 3"}),e.jsx(Ke,{dataKey:"name"}),e.jsx(Je,{}),e.jsx(Me,{}),e.jsx(st,{dataKey:"value",fill:"#2563eb"})]})})]}),ee.length>0&&e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("h3",{style:{marginBottom:"16px"},children:"By Client Type"}),e.jsx(Oe,{width:"100%",height:300,children:e.jsxs(St,{children:[e.jsx(Ct,{data:ee,cx:"50%",cy:"50%",labelLine:!1,label:({name:m,percent:z})=>`${m}: ${(z*100).toFixed(0)}%`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:ee.map((m,z)=>e.jsx(kt,{fill:ft[z%ft.length]},`cell-${z}`))}),e.jsx(Me,{})]})})]})]}),ne.length>0&&e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",marginBottom:"24px"},children:[e.jsx("h3",{style:{marginBottom:"16px"},children:"Peak Hours"}),e.jsx(Oe,{width:"100%",height:300,children:e.jsxs(tn,{data:ne,children:[e.jsx(Qe,{strokeDasharray:"3 3"}),e.jsx(Ke,{dataKey:"hour"}),e.jsx(Je,{}),e.jsx(Me,{}),e.jsx(nn,{type:"monotone",dataKey:"value",stroke:"#2563eb",strokeWidth:2})]})})]}),q.length>0&&e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("h3",{style:{marginBottom:"16px"},children:"By Staff"}),e.jsx(Oe,{width:"100%",height:300,children:e.jsxs(it,{data:q,children:[e.jsx(Qe,{strokeDasharray:"3 3"}),e.jsx(Ke,{dataKey:"name"}),e.jsx(Je,{}),e.jsx(Me,{}),e.jsx(st,{dataKey:"value",fill:"#10b981"})]})})]})]})}function Tn({staffIdleMinutes:t=5,onStaffIdleMinutesSaved:i}){const[s,o]=n.useState(null),[a,d]=n.useState(null),[C,h]=n.useState(null),[p,g]=n.useState(""),[u,r]=n.useState(!1),[S,T]=n.useState(!0),[P,f]=n.useState(!1),[N,y]=n.useState({open:!1}),[l,D]=n.useState(null),[A,R]=n.useState(null),[E,H]=n.useState(!1),[$,oe]=n.useState({open:!1}),[ee,q]=n.useState([{id:"",name:""},{id:"",name:""},{id:"",name:""}]),[ne,m]=n.useState(""),[z,Q]=n.useState(!1),[U,de]=n.useState("youtube"),[me,ge]=n.useState(!1),[c,v]=n.useState(""),[L,w]=n.useState(!1),[G,ae]=n.useState("5"),[fe,pe]=n.useState(!1),[be,Ee]=n.useState("branding"),[Te,Ue]=n.useState({open:!1}),[Ye,_e]=n.useState(!1),[De,b]=n.useState(String(t)),[B,I]=n.useState(!1);n.useEffect(()=>{b(String(t))},[t]),n.useEffect(()=>{_(),Y(),X(),K(),Z(),ie(),W()},[]);const Y=async()=>{try{const x=await j.get("/admin/settings/site-title");g(x.data.siteTitle??"")}catch(x){console.error("Failed to load site title:",x)}},_=async()=>{try{const x=await j.get("/admin/settings/logo");x.data.logoUrl&&h(x.data.logoUrl)}catch(x){console.error("Failed to load logo:",x)}finally{T(!1)}},X=async()=>{try{const x=await j.get("/admin/settings/ding-sound");x.data.dingSoundUrl&&R(x.data.dingSoundUrl)}catch(x){console.error("Failed to load ding sound:",x)}},K=async()=>{var x;try{const k=await j.get("/admin/settings/tts-voices"),O=Array.isArray(k.data.voices)?k.data.voices:[],V=[...O];for(;V.length<3;)V.push({id:"",name:""});q(V.slice(0,3)),k.data.activeVoiceId?m(k.data.activeVoiceId):(x=O[0])!=null&&x.id&&m(O[0].id)}catch(k){console.error("Failed to load TTS voices:",k)}},Z=async()=>{try{const x=await j.get("/admin/settings/video-source");de(x.data.videoSource||"youtube")}catch(x){console.error("Failed to load video source:",x)}},W=async()=>{try{const k=(await j.get("/admin/settings/video-volume")).data.videoVolumePercent;typeof k=="number"&&!Number.isNaN(k)&&ae(String(Math.max(0,Math.min(100,k))))}catch(x){console.error("Failed to load video volume:",x)}},ie=async()=>{try{const k=(await j.get("/admin/settings/youtube-playlist")).data.urls||[];v(k.join(`
`))}catch(x){console.error("Failed to load YouTube playlist:",x)}},ce=async x=>{var k,O;ge(!0);try{await j.post("/admin/settings/video-source",{videoSource:x}),de(x),J("Video source updated successfully!")}catch(V){F(((O=(k=V.response)==null?void 0:k.data)==null?void 0:O.error)||"Failed to save video source")}finally{ge(!1)}},le=async x=>{var O,V;x.preventDefault();const k=c.split(`
`).map(se=>se.trim()).filter(se=>se);w(!0);try{await j.post("/admin/settings/youtube-playlist",{urls:k}),J("YouTube playlist saved!")}catch(se){F(((V=(O=se.response)==null?void 0:O.data)==null?void 0:V.error)||"Failed to save playlist")}finally{w(!1)}},te=x=>{const k=x.target.files[0];if(k){o(k);const O=new FileReader;O.onloadend=()=>{d(O.result)},O.readAsDataURL(k)}},we=async x=>{var k,O;if(x.preventDefault(),!!s){f(!0);try{const V=new FormData;V.append("logo",s);const se=await j.post("/admin/settings/logo",V,{headers:{"Content-Type":"multipart/form-data"}});h(se.data.logoUrl),o(null),d(null),J("Logo uploaded successfully!")}catch(V){console.error("Failed to upload logo:",V),F(((O=(k=V.response)==null?void 0:k.data)==null?void 0:O.error)||"Failed to upload logo")}finally{f(!1)}}},he=async()=>{y({open:!0,title:"Delete Logo",message:"Are you sure you want to delete the current logo?",onConfirm:async()=>{var x,k;y({open:!1});try{await j.delete("/admin/settings/logo"),h(null),o(null),d(null),J("Logo deleted successfully!")}catch(O){console.error("Failed to delete logo:",O),F(((k=(x=O.response)==null?void 0:x.data)==null?void 0:k.error)||"Failed to delete logo")}},onCancel:()=>y({open:!1})})},ve=x=>{const k=x.target.files[0];k&&D(k)},ue=async x=>{var k,O;if(x.preventDefault(),!!l){H(!0);try{const V=new FormData;V.append("sound",l);const se=await j.post("/admin/settings/ding-sound",V,{headers:{"Content-Type":"multipart/form-data"}});R(se.data.dingSoundUrl),D(null),J("Ding sound uploaded successfully!")}catch(V){console.error("Failed to upload ding sound:",V),F(((O=(k=V.response)==null?void 0:k.data)==null?void 0:O.error)||"Failed to upload ding sound")}finally{H(!1)}}},Be=async()=>{oe({open:!0,title:"Delete Ding Sound",message:"Are you sure you want to delete the current ding sound?",onConfirm:async()=>{var x,k;oe({open:!1});try{await j.delete("/admin/settings/ding-sound"),R(null),D(null),J("Ding sound deleted successfully!")}catch(O){console.error("Failed to delete ding sound:",O),F(((k=(x=O.response)==null?void 0:x.data)==null?void 0:k.error)||"Failed to delete ding sound")}},onCancel:()=>oe({open:!1})})},ye=async x=>{const k=typeof x=="string"?x.trim():"";if(!k){F("Please enter a voice ID first");return}const O="Window 1 will now serve number 123, or John Doe.";try{const se=(await j.post("/tts",{text:O,voiceId:k},{responseType:"arraybuffer"})).data;if(!se)return;const We=new Blob([se],{type:"audio/mpeg"}),nt=URL.createObjectURL(We);new Audio(nt).play().catch(Pe=>{console.error("Failed to play preview TTS audio:",Pe)}).finally(()=>{URL.revokeObjectURL(nt)})}catch(V){console.error("Failed to preview TTS voice:",V),F("Failed to preview this voice. Please check your ElevenLabs settings.")}},ze=(x,k,O)=>{q(V=>{const se=[...V];return se[x]={...se[x],[k]:O},se})},Re=async x=>{var k,O;x.preventDefault(),Q(!0);try{const V=ee.map(Pe=>({id:(Pe.id||"").trim(),name:(Pe.name||"").trim()})).filter(Pe=>Pe.id);if(V.length===0){F("Please enter at least one ElevenLabs voice ID"),Q(!1);return}const se=ne&&V.some(Pe=>Pe.id===ne)?ne:V[0].id,We=await j.post("/admin/settings/tts-voices",{voices:V,activeVoiceId:se}),Ge=[...Array.isArray(We.data.voices)?We.data.voices:V];for(;Ge.length<3;)Ge.push({id:"",name:""});q(Ge.slice(0,3)),m(We.data.activeVoiceId||se),J("TTS voices updated successfully!")}catch(V){console.error("Failed to save TTS voices:",V),F(((O=(k=V.response)==null?void 0:k.data)==null?void 0:O.error)||"Failed to save TTS voices")}finally{Q(!1)}};return S?e.jsx(ke,{}):e.jsxs("div",{children:[e.jsx(Le,{...N}),e.jsx(Le,{...$}),e.jsx(Le,{...Te}),e.jsx("h2",{style:{fontSize:"20px",fontWeight:"600",marginBottom:"16px"},children:"Settings"}),e.jsx("div",{style:{display:"flex",gap:"8px",marginBottom:"24px",borderBottom:"1px solid #e2e8f0",paddingBottom:"4px",overflowX:"auto"},children:[{id:"branding",label:"Branding"},{id:"audio",label:"Audio & TTS"},{id:"videos",label:"Videos"},{id:"data",label:"Data"}].map(x=>{const k=be===x.id;return e.jsx("button",{type:"button",onClick:()=>Ee(x.id),style:{padding:"8px 16px",borderRadius:"9999px",border:"none",backgroundColor:k?"#1d4ed8":"transparent",color:k?"#ffffff":"#475569",fontSize:"14px",fontWeight:k?600:500,cursor:"pointer",boxShadow:k?"0 1px 3px rgba(15, 23, 42, 0.25)":"none",whiteSpace:"nowrap"},children:x.label},x.id)})}),be==="branding"&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"24px"},children:[e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderTop:"3px solid #2563eb"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"Logo"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"24px"},children:"Upload a logo to display across all pages. Supported formats: JPG, PNG, GIF, SVG, WebP (max 5MB)"}),C&&e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"500",marginBottom:"8px"},children:"Current Logo:"}),e.jsx("img",{src:C,alt:"Current logo",style:{maxWidth:"200px",maxHeight:"100px",objectFit:"contain",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"8px"}})]}),e.jsxs("form",{onSubmit:we,children:[e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500"},children:"Upload New Logo"}),e.jsx("input",{type:"file",accept:"image/*",onChange:te,style:{width:"100%",padding:"8px",border:"2px solid #e2e8f0",borderRadius:"8px",fontSize:"14px"}})]}),a&&e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"500",marginBottom:"8px"},children:"Preview:"}),e.jsx("img",{src:a,alt:"Preview",style:{maxWidth:"200px",maxHeight:"100px",objectFit:"contain",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"8px"}})]}),e.jsxs("div",{className:"admin-settings-buttons",style:{display:"flex",gap:"8px"},children:[e.jsx(M,{type:"submit",disabled:!s||P,children:P?"Uploading...":"Upload Logo"}),C&&e.jsx(M,{variant:"danger",onClick:he,children:"Delete Logo"})]})]})]}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderTop:"3px solid #2563eb"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"Site title"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"24px"},children:"This title appears next to (or below) the logo on every page."}),e.jsxs("form",{onSubmit:async x=>{var k,O;x.preventDefault(),r(!0);try{await j.post("/admin/settings/site-title",{siteTitle:p.trim()}),J("Site title saved.")}catch(V){F(((O=(k=V.response)==null?void 0:k.data)==null?void 0:O.error)||"Failed to save site title")}finally{r(!1)}},style:{maxWidth:"400px",display:"flex",flexDirection:"column",gap:"8px"},children:[e.jsx("label",{style:{fontSize:"14px",fontWeight:"500",color:"#1e293b"},children:"Title"}),e.jsx("input",{type:"text",value:p,onChange:x=>g(x.target.value),placeholder:"e.g. My Office Name",maxLength:120,style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px"}}),e.jsx("div",{style:{marginTop:"8px"},children:e.jsx(M,{type:"submit",disabled:u,children:u?"Saving...":"Save title"})})]})]})]}),be==="audio"&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"24px"},children:[e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderTop:"3px solid #f97316"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"Ding Sound (Announcement Chime)"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"24px"},children:"Upload a short audio file to play before each queue announcement on the public monitoring page. Supported formats: MP3, WAV, OGG, M4A, AAC (max 2MB). Keep it brief (under 2 seconds) for best results."}),A&&e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"500",marginBottom:"8px"},children:"Current Ding Sound:"}),e.jsx("audio",{controls:!0,src:A,style:{width:"100%",maxWidth:"400px"},children:"Your browser does not support the audio element."})]}),e.jsxs("form",{onSubmit:ue,children:[e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500"},children:"Upload New Ding Sound"}),e.jsx("input",{type:"file",accept:"audio/*",onChange:ve,style:{width:"100%",padding:"8px",border:"2px solid #e2e8f0",borderRadius:"8px",fontSize:"14px"}})]}),e.jsxs("div",{className:"admin-settings-buttons",style:{display:"flex",gap:"8px"},children:[e.jsx(M,{type:"submit",disabled:!l||E,children:E?"Uploading...":"Upload Ding Sound"}),A&&e.jsx(M,{variant:"danger",onClick:Be,children:"Delete Ding Sound"})]})]})]}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderTop:"3px solid #10b981"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"Text-to-Speech Voices (ElevenLabs)"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"16px"},children:"Configure up to three ElevenLabs voice IDs and choose which one is active for queue announcements. Voice IDs can be copied from your ElevenLabs dashboard."}),e.jsxs("form",{onSubmit:Re,children:[ee.map((x,k)=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(0, 1.2fr) minmax(0, 1.4fr) auto",gap:"12px",marginBottom:"12px",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsxs("label",{style:{display:"block",marginBottom:"4px",fontSize:"13px",fontWeight:"500"},children:["Voice ",k+1," Name (optional)"]}),e.jsx("input",{type:"text",value:x.name||"",onChange:O=>ze(k,"name",O.target.value),placeholder:"e.g. Front Desk Female",style:{width:"100%",padding:"8px 10px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px"}})]}),e.jsxs("div",{children:[e.jsxs("label",{style:{display:"block",marginBottom:"4px",fontSize:"13px",fontWeight:"500"},children:["Voice ",k+1," ID"]}),e.jsx("input",{type:"text",value:x.id||"",onChange:O=>ze(k,"id",O.target.value),placeholder:"ElevenLabs voice ID",style:{width:"100%",padding:"8px 10px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px",fontFamily:"monospace"}})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"6px"},children:[e.jsx("button",{type:"button",onClick:()=>ye(x.id),disabled:!x.id,style:{padding:"6px 10px",borderRadius:"6px",border:"1px solid #e2e8f0",backgroundColor:x.id?"#eff6ff":"#f8fafc",color:x.id?"#2563eb":"#94a3b8",fontSize:"12px",fontWeight:500,cursor:x.id?"pointer":"not-allowed"},children:"Preview Voice"}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"13px"},children:[e.jsx("input",{type:"radio",name:"activeVoice",checked:!!x.id&&ne===x.id,disabled:!x.id,onChange:()=>{x.id&&m(x.id)}}),"Active"]})]})]},k)),e.jsx("div",{style:{marginTop:"16px",display:"flex",gap:"8px"},children:e.jsx(M,{type:"submit",disabled:z,children:z?"Saving Voices...":"Save Voices"})})]})]})]}),be==="videos"&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"24px"},children:[e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderTop:"3px solid #6366f1"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"Video Source"}),e.jsxs("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"20px"},children:[e.jsx("strong",{children:"YouTube"})," plays videos from a playlist you define. ",e.jsx("strong",{children:"Local"})," lets the display pick a folder on that computer."]}),e.jsxs("div",{style:{display:"flex",gap:"16px",flexWrap:"wrap"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",border:`2px solid ${U==="youtube"?"#6366f1":"#e2e8f0"}`,borderRadius:"8px",cursor:"pointer",backgroundColor:U==="youtube"?"#eef2ff":"transparent"},children:[e.jsx("input",{type:"radio",name:"videoSource",value:"youtube",checked:U==="youtube",onChange:()=>ce("youtube"),disabled:me}),e.jsxs("span",{children:[e.jsx("strong",{children:"YouTube"})," â€“ Playlist from admin-defined URLs"]})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",border:`2px solid ${U==="local"?"#6366f1":"#e2e8f0"}`,borderRadius:"8px",cursor:"pointer",backgroundColor:U==="local"?"#eef2ff":"transparent"},children:[e.jsx("input",{type:"radio",name:"videoSource",value:"local",checked:U==="local",onChange:()=>ce("local"),disabled:me}),e.jsxs("span",{children:[e.jsx("strong",{children:"Local"})," â€“ Folder on the display computer"]})]})]})]}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderTop:"3px solid #0ea5e9"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"12px"},children:"Default video volume"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"16px"},children:"Set the default playback volume for monitor videos (0 to 100%). This is applied when the monitor page starts."}),e.jsxs("form",{onSubmit:async x=>{var O,V;x.preventDefault();const k=Number(G);if(!Number.isFinite(k)||k<0||k>100){F("Volume must be a number between 0 and 100.");return}pe(!0);try{await j.post("/admin/settings/video-volume",{videoVolumePercent:k}),ae(String(Math.round(k))),J("Default video volume saved.")}catch(se){F(((V=(O=se.response)==null?void 0:O.data)==null?void 0:V.error)||"Failed to save video volume")}finally{pe(!1)}},style:{maxWidth:"260px",display:"flex",flexDirection:"column",gap:"8px"},children:[e.jsx("label",{style:{fontSize:"14px",fontWeight:"500",color:"#1e293b"},children:"Volume (0â€“100%)"}),e.jsx("input",{type:"number",min:0,max:100,value:G,onChange:x=>ae(x.target.value.replace(/[^\d]/g,"").slice(0,3)),style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px"}}),e.jsx("div",{style:{fontSize:"12px",color:"#94a3b8"},children:"Example: 0 = muted, 50 = half volume, 100 = full volume."}),e.jsx("div",{style:{marginTop:"8px"},children:e.jsx(M,{type:"submit",disabled:fe,children:fe?"Saving...":"Save volume"})})]})]}),U==="youtube"&&e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderTop:"3px solid #6366f1"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"YouTube Playlist"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"24px"},children:"List YouTube URLs (one per line). Videos play in order on the monitor. Supports youtube.com/watch?v= and youtu.be/ links."}),e.jsxs("form",{onSubmit:le,children:[e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500"},children:"YouTube URLs"}),e.jsx("textarea",{value:c,onChange:x=>v(x.target.value),placeholder:`https://www.youtube.com/watch?v=VIDEO_ID
https://youtu.be/VIDEO_ID`,rows:8,style:{width:"100%",padding:"12px 16px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px",fontFamily:"monospace",backgroundColor:"#f8fafc",color:"#1e293b",resize:"vertical",boxSizing:"border-box"},onFocus:x=>{x.target.style.borderColor="#2563eb",x.target.style.backgroundColor="#ffffff"},onBlur:x=>{x.target.style.borderColor="#e2e8f0",x.target.style.backgroundColor="#f8fafc"}})]}),e.jsx(M,{type:"submit",disabled:L,children:L?"Saving...":"Save Playlist"})]})]}),U==="local"&&e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderLeft:"4px solid #22c55e"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"12px"},children:"Local videos"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",margin:0},children:"When the monitoring page loads, the user will select a folder containing video files. Videos play directly from that computer. Works in Chrome and Edge."})]})]}),be==="data"&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"24px"},children:[e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderTop:"3px solid #22c55e"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"Staff idle threshold"}),e.jsxs("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"16px"},children:["After this many minutes without activity (e.g. opening the staff dashboard or profile), a staff member is shown as ",e.jsx("strong",{children:"Offline"})," on the Staff page. (1â€“120 minutes.)"]}),e.jsxs("form",{onSubmit:async x=>{var O,V;x.preventDefault();const k=Number(De);if(!Number.isFinite(k)||k<1||k>120){F("Enter a number between 1 and 120.");return}I(!0);try{const We=(await j.post("/admin/settings/staff-idle-minutes",{staffIdleMinutes:Math.round(k)})).data.staffIdleMinutes;b(String(We)),typeof i=="function"&&i(We),J("Staff idle threshold saved.")}catch(se){F(((V=(O=se.response)==null?void 0:O.data)==null?void 0:V.error)||"Failed to save.")}finally{I(!1)}},style:{maxWidth:"260px",display:"flex",flexDirection:"column",gap:"8px"},children:[e.jsx("label",{style:{fontSize:"14px",fontWeight:"500",color:"#1e293b"},children:"Minutes (1â€“120)"}),e.jsx("input",{type:"number",min:1,max:120,value:De,onChange:x=>b(x.target.value.replace(/[^\d]/g,"").slice(0,3)),style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px"}}),e.jsx("div",{style:{marginTop:"8px"},children:e.jsx(M,{type:"submit",disabled:B,children:B?"Saving...":"Save"})})]})]}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderTop:"3px solid #dc2626"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"Reset queue stats"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"24px"},children:"Permanently delete all queue entries, serving logs, and daily queue counters. Staff, windows, and categories are not affected. This cannot be undone."}),e.jsx(M,{variant:"danger",disabled:Ye,onClick:()=>{Ue({open:!0,title:"Reset all queue stats?",message:"This will delete all queue entries, serving logs, and daily counters. Staff, windows, and categories will be kept. This action cannot be undone.",onConfirm:async()=>{var x,k;Ue({open:!1}),_e(!0);try{await j.post("/admin/settings/reset-queue-stats"),J("Queue stats reset successfully.")}catch(O){F(((k=(x=O.response)==null?void 0:x.data)==null?void 0:k.error)||"Failed to reset queue stats")}finally{_e(!1)}},onCancel:()=>Ue({open:!1})})},children:Ye?"Resetting...":"Reset queue stats"})]})]})]})}function Dn(){const t=Ce(),[i,s]=n.useState(!0),[o,a]=n.useState(null),[d,C]=n.useState(""),[h,p]=n.useState(!1),[g,u]=n.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[r,S]=n.useState(!1),[T,P]=n.useState(!1);n.useEffect(()=>{const l=localStorage.getItem("token"),D=Ae();if(!l||(D==null?void 0:D.role)!=="ADMIN"){t("/admin/login");return}f()},[t]),n.useEffect(()=>{C((o==null?void 0:o.name)??"")},[o==null?void 0:o.name]);const f=async()=>{var l;try{const D=await j.get("/admin/profile");a(D.data.admin)}catch(D){console.error("Failed to load profile:",D),((l=D.response)==null?void 0:l.status)===401&&t("/admin/login")}finally{s(!1)}},N=async l=>{var A,R,E,H,$,oe;l.preventDefault();const D=(d??"").trim();P(!0);try{const ee=await j.put("/admin/profile",{name:D||null});a(ee.data.admin);const q=Ae();q&&(q.name=ee.data.admin.name??null,localStorage.setItem("user",JSON.stringify(q))),J("Name updated successfully")}catch(ee){F(((R=(A=ee.response)==null?void 0:A.data)==null?void 0:R.error)||((oe=($=(H=(E=ee.response)==null?void 0:E.data)==null?void 0:H.errors)==null?void 0:$[0])==null?void 0:oe.msg)||"Failed to update name")}finally{P(!1)}},y=async l=>{var D,A;if(l.preventDefault(),g.newPassword!==g.confirmPassword){F("New passwords do not match");return}if(g.newPassword.length<6){F("Password must be at least 6 characters");return}S(!0);try{await j.post("/admin/profile/change-password",{currentPassword:g.currentPassword,newPassword:g.newPassword}),J("Password changed successfully!"),p(!1),u({currentPassword:"",newPassword:"",confirmPassword:""})}catch(R){F(((A=(D=R.response)==null?void 0:D.data)==null?void 0:A.error)||"Failed to change password")}finally{S(!1)}};return i?e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ke,{})}):e.jsxs("div",{className:"admin-profile-root",style:{minHeight:"100vh",background:"#f8fafc"},children:[e.jsx("style",{children:`
        .admin-profile-root { padding-left: env(safe-area-inset-left); padding-right: env(safe-area-inset-right); }
        @media (max-width: 768px) {
          .admin-profile-header { flex-wrap: wrap; gap: 12px; padding: 12px 16px !important; }
          .admin-profile-content { margin: 24px auto !important; padding: 0 16px !important; }
          .admin-profile-card { padding: 24px !important; }
        }
      `}),e.jsxs("div",{className:"admin-profile-header",style:{background:"white",borderBottom:"1px solid #e2e8f0",padding:"16px 24px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(Ie,{size:"small"}),e.jsx(M,{variant:"outline",icon:yt,onClick:()=>t("/admin/dashboard"),children:"Back to Dashboard"})]}),e.jsx("div",{className:"admin-profile-content",style:{maxWidth:"600px",margin:"40px auto",padding:"0 24px"},children:e.jsxs("div",{className:"admin-profile-card",style:{background:"white",borderRadius:"12px",padding:"32px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",marginBottom:"24px",color:"#1e293b"},children:"Admin Profile"}),e.jsxs("form",{onSubmit:N,children:[e.jsx(re,{label:"Name",value:d,onChange:l=>C(l.target.value),placeholder:"Your display name"}),e.jsx(M,{type:"submit",icon:bt,disabled:T,style:{marginTop:"16px"},children:T?"Saving...":"Save name"})]}),e.jsx("div",{style:{marginTop:"24px"},children:e.jsx(re,{label:"Username",value:(o==null?void 0:o.username)||"",disabled:!0,readOnly:!0,style:{background:"#f1f5f9",color:"#64748b",cursor:"not-allowed",border:"2px solid #e2e8f0",borderRadius:"8px",padding:"12px"}})}),e.jsxs("div",{style:{marginTop:"32px",paddingTop:"32px",borderTop:"1px solid #e2e8f0"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"#1e293b"},children:"Change Password"}),e.jsx(M,{variant:"outline",icon:lt,onClick:()=>{p(!h),h&&u({currentPassword:"",newPassword:"",confirmPassword:""})},children:h?"Cancel":"Change Password"})]}),h&&e.jsxs("form",{onSubmit:y,children:[e.jsx(re,{label:"Current Password",type:"password",value:g.currentPassword,onChange:l=>u({...g,currentPassword:l.target.value}),required:!0}),e.jsx(re,{label:"New Password",type:"password",value:g.newPassword,onChange:l=>u({...g,newPassword:l.target.value}),required:!0}),e.jsx(re,{label:"Confirm New Password",type:"password",value:g.confirmPassword,onChange:l=>u({...g,confirmPassword:l.target.value}),required:!0}),e.jsx(M,{type:"submit",icon:vt,disabled:r,style:{marginTop:"16px"},children:r?"Changing...":"Change Password"})]})]})]})})]})}function zn(){return n.useEffect(()=>{let t=document.querySelector('link[rel="icon"]');t||(t=document.createElement("link"),t.rel="icon",document.head.appendChild(t));const i=d=>{const C=d&&!d.startsWith("http")&&!d.startsWith("data:")?d.startsWith("/")?window.location.origin+d:window.location.origin+"/"+d:d;t.href=C},s="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%23667eea' rx='12'/%3E%3Ctext x='50' y='68' font-size='60' font-weight='bold' dominant-baseline='middle' text-anchor='middle' fill='white' font-family='system-ui,sans-serif'%3EQ%3C/text%3E%3C/svg%3E",o=async()=>{var d;try{const C=await j.get("/admin/settings/logo");(d=C.data)!=null&&d.logoUrl?i(C.data.logoUrl):i(s)}catch{i(s)}};o();const a=setInterval(o,3e4);return()=>clearInterval(a)},[]),null}function Rn(){return e.jsxs(e.Fragment,{children:[e.jsx(zn,{}),e.jsx(fn,{}),e.jsxs(Jt,{children:[e.jsx(je,{path:"/",element:e.jsx(rn,{})}),e.jsx(je,{path:"/success",element:e.jsx(dn,{})}),e.jsx(je,{path:"/thank-you",element:e.jsx(cn,{})}),e.jsx(je,{path:"/monitor",element:e.jsx(pn,{})}),e.jsx(je,{path:"/staff/login",element:e.jsx(un,{})}),e.jsx(je,{path:"/staff/dashboard",element:e.jsx(hn,{})}),e.jsx(je,{path:"/staff/profile",element:e.jsx(mn,{})}),e.jsx(je,{path:"/admin/login",element:e.jsx(yn,{})}),e.jsx(je,{path:"/admin/dashboard",element:e.jsx(wn,{})}),e.jsx(je,{path:"/admin/profile",element:e.jsx(Dn,{})})]})]})}Xt.createRoot(document.getElementById("root")).render(e.jsx(Zt.StrictMode,{children:e.jsx(en,{children:e.jsx(Rn,{})})}));
